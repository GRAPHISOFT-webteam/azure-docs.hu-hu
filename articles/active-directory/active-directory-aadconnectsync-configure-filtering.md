<properties
    pageTitle="Azure AD Connect 同步處理：設定篩選 | Microsoft Azure"
    description="說明如何在 Azure AD Connect 同步處理中設定篩選。"
    services="active-directory"
    documentationCenter=""
    authors="markusvi"
    manager="stevenpo"
    editor=""/>

<tags
    ms.service="active-directory"
    ms.workload="identity"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/13/2015"
    ms.author="markusvi;andkjell"/>


# Azure AD Connect 同步處理：設定篩選

在 Azure AD Connect 同步處理中，您隨時都能啟用篩選功能。 如果您已經執行了目錄同步作業的預設設定，接著設定了篩選，則篩選出的物件就不會再同步處理至 Azure AD。 因此，系統會在 Azure AD 中，刪除 Azure AD 中先前已同步處理但接著篩選出的所有物件。 如果物件是因為篩選錯誤而遭到意外刪除，您可以在 Azure AD 中重新建立物件，方法是移除您的篩選設定，然後再次同步處理您的目錄。

> [AZURE.IMPORTANT]Microsoft 不支援修改或操作的正式記載以外，Azure AD Connect 同步處理。 所有的這些動作都可能造成 Azure AD Connect 同步處理變成不一致或不支援的狀態，因此，Microsoft 無法針對這類部署提供技術支援。

但以輸出屬性為基礎的篩選例外，當您安裝或升級至較新版本的 Azure AD Connect 時，將會保留設定。 在升級至較新版本之後且在首次執行同步處理循環之前，最好一律先確認設定並未遭到意外變更。


## 篩選選項

> [AZURE.NOTE]本主題中，會使用來源 AD 做為您的 Active Directory 網域服務連接器的名稱。 如果您有多個樹系，就會針對每個樹系擁有一個 Connector，而且必須針對每個樹系重複進行設定。

下列三個篩選設定類型可套用至目錄同步作業工具：

- [**網域**] (#configure-網域型篩選): 您可以使用這個篩選類型來管理 Azure AD Connect 同步處理中 SourceAD 連接器的內容。 此類型讓您能夠選取要允許哪些網域可同步處理至 Azure AD。

- [**設定組織單位型篩選**] (#configure-組織單位型篩選): 您可以使用這個篩選類型來管理 Azure AD Connect 同步處理中 SourceAD 連接器的內容。 此篩選類型讓您能夠選取要允許哪些 OU 可同步處理至 Azure AD。

- [**屬性型**](#configure-attribute-based-filtering)︰ 您可以使用這個篩選方法來指定屬性型篩選。 這讓您能夠控制應將哪些物件同步處理至雲端。

> [AZURE.NOTE]如果您要篩選組態進行變更，並使用密碼同步處理您需要完成組態之後，觸發完整同步處理所有密碼。 如需如何觸發密碼完整同步處理請參閱 [觸發完整同步處理所有密碼](active-directory-aadconnectsync-implement-password-synchronization.md#trigger-a-full-sync-of-all-passwords)

## 設定網域型篩選

本節提供您設定網域篩選需執行的步驟。

如果您在安裝 Azure AD Connect 之後新增或移除樹系中的網域，則您也必須更新篩選設定。


### 變更現有網域的篩選

> [AZURE.NOTE] 如果您已修改網域篩選，您也需要更新執行設定檔。


**若要設定網域篩選，請執行下列步驟：**

1. 登入執行 Azure AD Connect 同步處理所使用的帳戶成員的電腦 **ADSyncAdmins** 安全性群組。

2. 在 **啟動**, ，點選或按一下 **同步處理服務** 開啟 **同步處理服務管理員**。

3. 若要開啟連接器檢視中，按一下 [ **連接器** 中 **工具** 功能表。

4. 在 **連接器** 清單中，選取連接器，所以 **Active Directory 網域服務** 為 **類型**。

5. 若要開啟 **屬性** ] 對話方塊中，按一下 **屬性** 中 **動作** 功能表。

6. 按一下 [ **設定目錄分割**。

7. 在 **選取目錄分割** 清單中，確認已選取您要同步處理的資料分割。 <br> 若要從同步處理程序移除某個網域，可清除該網域的核取方塊。

8. 若要關閉 **屬性** ] 對話方塊中，按一下 [ **確定**。


如果您已更新網域篩選，則也需更新下列執行設定檔：

- 完整匯入
- 完整同步處理
- 差異匯入
- 差異同步處理
- 匯出


如果您有 **移除** 目錄分割清單從一個資料分割，您必須確定也會移除參照此分割的所有執行設定檔步驟。

**若要移除執行設定檔中的步驟，請執行下列步驟：**

1. 在 **連接器** 清單中，選取連接器，所以 **Active Directory 網域服務** 為 **類型**。

2. 若要開啟 **設定執行設定檔** ] 對話方塊中，按一下 [ **設定執行設定檔** 中 **動作** 功能表。

3. 在 **連接器執行設定檔** 清單中，選取您想要設定執行設定檔

4. 針對步驟詳細資料清單中的每個步驟，執行下列步驟：

     4.1. 視需要按一下步驟，以展開步驟詳細資料。

     4.2. 如果 **值** 的 **分割** 屬性是 GUID，可按一下 [刪除步驟。

5. 若要關閉 **設定執行設定檔** ] 對話方塊中，按一下 [ **確定**。

如果您有 **加入** 目錄分割清單的資料分割，您需要確定該磁碟分割的執行設定檔步驟可用每個執行設定檔，在上述清單中。

**若要在執行設定檔中新增步驟，請執行下列步驟：**

1. 在 **連接器** 清單中，選取連接器，所以 **Active Directory 網域服務** 為 **類型**。

2. 若要開啟 **設定執行設定檔** ] 對話方塊中，按一下 [ **設定執行設定檔** 中 **動作** 功能表。

3. 在 **連接器執行設定檔** 清單中，選取您想要設定執行設定檔

4. 若要開啟 **設定執行設定檔** ] 對話方塊中，按一下 [ **新增步驟**。

5. 在 **設定步驟** 頁面，在步驟類型清單中，選取步驟類型，然後再按一下 **下一步**。

6. 在 **連接器設定** 頁面上，於 **分割** 清單中，選取您已加入網域篩選資料分割的名稱。

7. 若要關閉 **設定執行設定檔** ] 對話方塊中，按一下 [ **完成**。

8. 若要關閉 **設定執行設定檔** ] 對話方塊中，按一下 [ **確定**。

### 針對新的或移除的網域變更篩選
如果您已將新的網域加入至樹系，或從樹系移除網域，則必須更新網域篩選設定。

**新增網域之後的步驟**

1. 登入執行 Azure AD Connect 同步處理所使用的帳戶成員的電腦 **ADSyncAdmins** 安全性群組。

2. 在 **啟動**, ，點選或按一下 **同步處理服務** 開啟 **同步處理服務管理員**。

3. 若要開啟連接器檢視中，按一下 [ **連接器** 中 **工具** 功能表。

4. 在 **連接器** 清單中，選取連接器，所以 **Active Directory 網域服務** 為 **類型**。

5. 若要開啟 **屬性** ] 對話方塊中，按一下 **屬性** 中 **動作** 功能表。

6. 按一下 [ **設定目錄分割**。

7. 按一下 [ **重新整理** 在頁面頂端的按鈕。

8. 在 **選取目錄分割** 清單中，選取新的網域。

9. 若要關閉 **屬性** ] 對話方塊中，按一下 [確定]。

請確定仍然選取相同的連接器。 現在必須設定連接器的執行設定檔。


- 完整匯入
- 完整同步處理
- 差異匯入
- 差異同步處理
- 匯出


10. 若要開啟 **設定執行設定檔** ] 對話方塊中，按一下 [ **設定執行設定檔** 中 **動作** 功能表。

11. 在 **連接器執行設定檔** 清單中，選取您想要設定執行設定檔

12. 若要開啟 **設定執行設定檔** ] 對話方塊中，按一下 [ **新增步驟**。

13. 在 **設定步驟** 頁面，在步驟類型清單中，選取步驟類型，然後再按一下 **下一步**。

14. 在 **連接器設定** 頁面上，於 **分割** 清單中，選取您已加入網域篩選資料分割的名稱。

15. 若要關閉 **設定執行設定檔** ] 對話方塊中，按一下 [ **完成**。

16. 若要關閉 **設定執行設定檔** ] 對話方塊中，按一下 [ **確定**。

17. 對所有執行設定檔重複這些步驟。

**移除網域之後的步驟**

1. 登入執行 Azure AD Connect 同步處理所使用的帳戶成員的電腦 **ADSyncAdmins** 安全性群組。

2. 在 **啟動**, ，點選或按一下 **同步處理服務** 開啟 **同步處理服務管理員**。

3. 若要開啟連接器檢視中，按一下 [ **連接器** 中 **工具** 功能表。

4. 在 **連接器** 清單中，選取連接器，所以 **Active Directory 網域服務** 為 **類型**。

5. 若要開啟 **屬性** ] 對話方塊中，按一下 **屬性** 中 **動作** 功能表。

6. 按一下 [ **設定目錄分割**。

7. 按一下 [ **重新整理** 在頁面頂端的按鈕。

8. 若要關閉 **屬性** ] 對話方塊中，按一下 [確定]。 將會出現快顯訊息，指出已移除網域且將會清除設定。

## 設定組織單位型篩選

**若要設定組織單位型篩選，請執行下列步驟：**

1. 登入執行 Azure AD Connect 同步處理所使用的帳戶成員的電腦 **ADSyncAdmins** 安全性群組。

2. 在 **啟動**, ，點選或按一下 **同步處理服務** 開啟 **同步處理服務管理員**。<br>

3. 在 **同步處理服務管理員**, ，按一下 [ **連接器**, ，然後按兩下 **SourceAD**。

4. 按一下 [ **設定目錄分割**, ，選取您想要設定，然後按一下 [的網域 **容器**。

5. 出現提示時，輸入您的網域認證的內部部署 Active Directory 樹系。<br> > [AZURE.NOTE]時出現認證對話方塊時，會顯示用來匯入和匯出到 AD DS 的帳戶。 如果您不知道帳戶的密碼，則可輸入另一個帳戶來使用。 您使用的帳戶必須有目前設定之網域的讀取權限。

6. 在 **選取容器** 對話方塊方塊中，清除您不想要與雲端目錄中，同步處理，然後按一下 [Ou **確定**。

7. 按一下 [ **確定** 上 **SourceAD 內容** 頁面。

8. 完成下列步驟，藉以執行完整匯入與差異同步處理：

     8.1. 在連接器清單中，選取 **SourceAD**

     8.2. 若要開啟 **執行連接器** 對話方塊中，選取 **執行** 從 **動作** 功能表。

     8.3. 在 **執行設定檔** 清單中，選取 **完整匯入**, ，然後等待執行設定檔，才能完成。

     8.4. 若要開啟 **執行連接器** 對話方塊中，選取 **執行** 從 **動作** 功能表。

     8.5. 在 **執行設定檔** 清單中，選取 **差異同步處理**, ，然後等待執行設定檔，才能完成。




## 設定屬性型篩選

有數種方式可用來設定以屬性為基礎的篩選。 建議使用從 AD 輸入的設定，因為即使升級到較新版本，這類組態設定還是能夠保留。 支援輸出至 AAD 的設定，但在升級到較新版本之後就不會保留這些設定，而且只有在需要查看 Metaverse 中的結合物件以判斷篩選時才能使用。

### 輸入篩選

輸入型篩選會運用預設設定，其中即將輸入 AAD 的物件不能為 metaverse 屬性 cloudFiltered 設定值，且必須將 metaverse 屬性 sourceObjectType 設為 "User" 或 "Contact"。

如果不應將物件同步處理至 Azure AD，就必須將 cloudFiltered 屬性設為 True，並在其他情況下保留空白。 當我們可以查看物件並假設不想同步處理物件 (負面篩選) 時，就會使用這個方法。

在下列範例中，將篩選出 extensionAttribute15 值為 NoSync 的所有使用者：

1. 使用隸屬於 ADSyncAdmins 安全性群組成員的帳戶，登入執行 Azure AD Connect 同步處理的電腦。
2. 開啟 **同步處理規則編輯器** 從 **開始功能表**。
3. 請確定 **輸入** 按一下 **新增規則**。
4. 為規則的描述性名稱，例如 「*中 from AD – User DoNotSyncFilter*」，選取正確的樹系， **使用者** 為 **CS 物件類型**, ，和 **人** 為 **MV 物件類型**。 做為 **連結類型**, ，請選取 **加入** 在優先順序中，輸入目前未使用另一個同步處理規則的值 (例如 ︰ 50)，然後按一下 [ **下一步**。
5. 在 **範圍設定篩選**, ，按一下 [ **加入群組**, ，按一下 [ **加入子句** 在屬性中選取 **ExtensionAttribute15**。 請確定運算子] 設為 **等於** 和 **類型** 非同步 （nosync） 在 [值] 方塊中的值。 按一下 [ **下一步**。
6. 保留 **加入** 空白，規則，然後按一下 [ **下一步**。
7. 按一下 [ **新增轉換**, ，請選取 **FlowType** 至 **常數**, 、 選取目標屬性 cloudFiltered，然後在 [來源] 文字方塊中輸入 True。 按一下 [新增] 以儲存規則。
8. 執行完整同步處理 ︰ 在 **連接器** 索引標籤上，以滑鼠右鍵按一下 **SourceAD**, ，按一下 **執行**, ，按一下 [ **完整同步處理**, ，然後按一下 [ **確定**。


屬性 **sourceObjectType** 將佈建 **使用者** 或 **連絡人** 至 Azure AD，如果這個屬性有值為 **使用者** 或 **連絡人** 分別。 您可以藉由建立優先順序較現成可用的同步處理規則還高的同步處理規則，來覆寫預設行為。 這個方法也讓您有機會表達正面與負面規則。

在下列範例中，您將只同步處理使用者當部門屬性為"*銷售*"或空白 ︰

1. 使用隸屬於 ADSyncAdmins 安全性群組成員的帳戶，登入執行 Azure AD Connect 同步處理的電腦。
2. 開啟 **同步處理規則編輯器** 從 **開始功能表**。
3. 請確定 **輸入** 已選取，然後按一下 [ **新增規則**。
4. 為規則指定描述性名稱 (例如: 「*中 from AD – User DoNotSyncFilter*」)，選取正確的樹系， **使用者** 為 **CS 物件類型**, ，和 **人** 為 **MV 物件類型**。 做為 **連結類型**, ，請選取 **加入** 和 **優先順序的型別**, ，目前不使用另一個同步處理規則的值 (例如 ︰ 60)。 按一下 [ **下一步**。
5. 保留 **範圍篩選器** 和 **聯結規則** 空白，然後按 **下一步** 兩次。
6. 按一下 [ **新增轉換**, ，請選取 **FlowType** 至 **運算式** ，然後選取 **目標屬性** 至 **sourceObjectType**。 在 **來源**, ，下列運算式中的型別 ︰<br>`IIF(IsNullOrEmpty([department]),NULL,IIF([department]<>”Sales”,”DoNotSync”,NULL))`
7. 按一下 [新增] 以儲存規則。
8. 執行完整同步處理 ︰ 在 **連接器** 索引標籤上，以滑鼠右鍵按一下 **SourceAD**, ，按一下 **執行**, ，按一下 [ **完整同步處理**, ，然後按一下 [ **確定**。 以下是此外觀類似的結果 ︰<br>

> [AZURE.NOTE] 請注意，我們使用混用 cloudFiltered 和 sourceObjectType 來判斷哪些我們要同步處理至 AAD 的物件。

使用運算式，您就能擁有非常強大的篩選選項。 在上述運算式中，請注意，若部門不存在以及部門為銷售部門，我們提供了常值 NULL。 這表示此屬性不會包含值，並將評估全新的規則。 我們需要的它們可判斷它是否 **使用者** 或 **連絡人** 我們應該在 Azure AD 中建立。


## 輸出型篩選

在某些情況下，只有在在 Metaverse 中聯結物件之後，才需進行篩選。 例如，您可能需要從資源樹系的 mail 屬性以及從帳戶樹系的 userPrincipalName 屬性，來判斷是否應同步處理物件。 在這些情況下，我們將在輸出規則上建立篩選。

> [AZURE.NOTE] 此方法需要變更現成的同步處理規則。 支援變更同步處理規則的範圍，但在升級到較新版本的 Azure AD Connect 之後可能不會保留該變更。 如果您使用輸出型篩選，請記下所做的變更，並在升級之後，確保篩選仍然存在，並在必要時重新套用。


我們將在此範例中變更篩選，如此一來，就只會同步處理 mail 和 userPrincipalName 都是以 @contoso.com 結束的使用者：

1. 使用隸屬於 ADSyncAdmins 安全性群組成員的帳戶，登入執行 Azure AD Connect 同步處理的電腦。
2. 在 [開始] 功能表中尋找 [同步處理規則編輯器] 並加以開啟。
3. 在 [規則類型] 下方按一下 [輸出]。
4. 尋找名為 Out to AAD – User Join 的規則。 按一下 [編輯]。
5. 按一下左邊瀏覽列上的 [範圍設定篩選]。 按一下 [新增子句]、在 [屬性] 中選取 [mail]、在 [運算子] 中選取 [ENDSWITH]，然後在 [值] 中輸入 @contoso.com。 按一下 [新增子句]、在 [屬性] 中選取 [userPrincipalName]、在 [運算子] 中選取 [ENDSWITH]，然後在 [值] 中輸入 @contoso.com。
6. 按一下 [儲存]。
7. 執行完整同步處理：在 [連接器] 索引標籤上，以滑鼠右鍵按一下 [SourceAD]，然後依序按一下 [執行]、 [完整同步處理] 及 [確定]。


## 後續步驟
深入了解 [Azure AD Connect 同步處理](active-directory-aadconnectsync-whatis.md) 組態。

深入了解 [整合內部部署身分識別與 Azure Active Directory](active-directory-aadconnect.md)。


