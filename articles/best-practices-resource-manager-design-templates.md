<properties
    pageTitle="設計 Azure 資源管理員範本的最佳做法"
    description="顯示 Azure 資源管理員範本的設計模式"
    services="azure-resource-manager"
    documentationCenter=""
    authors="mmercuri"
    manager="georgem"
    editor="tysonn"/>

<tags
    ms.service="azure-resource-manager"
    ms.workload="multiple"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="08/13/2015"
    ms.author="mmercuri"/>

# 設計 Azure 資源管理員範本的最佳做法

與企業、 系統整合者 (Si)、 雲端服務廠商 (Csv) 和開放原始碼軟體 (OSS) 專案小組合作，並經常需要快速 
部署環境、 工作負載或縮放單位。 這些部署需要受到支援、依照經過實證的做法執行，並遵循所識別的原則。 使用彈性 
Azure 資源管理員範本為基礎的方法您可以快速且一致地部署複雜的拓撲，並再調整這些部署輕鬆地為 
核心供應項目的發展或是適應極端案例或客戶的變化。

本主題是較大份白皮書的一部分。 若要閱讀完整的文件、 下載 [世界類別 ARM 範本的考量和已證實實務] (http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World 類別 ARM 範本-考量和證明 Practices.pdf)。

範本會結合基礎 Azure 資源管理員的優點，以及 JavaScript 物件標記法 (JSON) 的適應性和可讀性。 使用 
範本，您可以 ︰

- 以一致的方式部署拓撲及其工作負載。
- 使用資源群組，一併管理應用程式中的所有資源。
- 套用角色型存取控制 (RBAC)，以授與使用者、群組和服務適當的存取權限。
- 使用標記關聯來簡化工作，例如計費彙總套件。

這篇文章提供詳細資料取用案例、 架構和實作模式期間，我們的設計工作階段以及真實世界範本識別 
Azure 客戶諮詢小組 (AzureCAT) 客戶的實作。 這些是遠離學術、 已經實證做法，通知所開發的範本 
針對 12 個以 Linux 為基礎的 OS 上的技術，包括 ︰ Apache Kafka、 Apache Spark、 Cloudera、 Couchbase、 Hortonworks HDP、 所提供的 DataStax Enterprise 
Apache Cassandra、 Elasticsearch、 Jenkins、 MongoDB、 Nagios、 PostgreSQL、 Redis 及 Nagios。 與知名廠商所開發的大部分的範本 
給定分佈和最近使用的專案期間受到 Microsoft 企業和 SI 客戶的需求。

本文將分享這些經過實證的最佳做法，以協助您設計世界級 Azure 資源管理員範本。  

透過與客戶合作，我們已在企業、系統整合者和 CSV 之間識別出許多資源管理員範本取用體驗。 
下列各節提供適用於不同客戶類型的常見案例和模式的整體概觀。

## 企業和系統整合者

在大型組織中，我們常看到兩種 ARM 範本的取用者：內部軟體開發團隊和公司 IT。 案例 
我們曾經使用過的 sIs 可對應到企業中，因此相同的考量。

### 內部軟體開發團隊

如果您的團隊會開發軟體來支援企業，則範本讓您能夠輕鬆快速地部署可用於企業特定解決方案的技術。 
您也可以使用範本快速建立訓練環境，讓團隊成員能夠取得所需的技巧。

您可以依原樣使用範本，或者擴充或撰寫它們來符合您的需求。 範本內使用標記，您可以提供與帳單摘要 
各種檢視，例如小組、 專案、 個人、 以及教育。

企業通常希望軟體開發團隊能夠建立一致部署的解決方案，同時還能提供限制，所以特定的範本 
在這個環境中的項目維持固定不變，並不能覆寫。 例如，銀行可能需要包含 RBAC，好讓程式設計師無法修改範本 
銀行將資料傳送給個人儲存體帳戶的方案。

### 公司 IT

公司 IT 組織通常會使用範本來傳遞雲端容量和雲端裝載功能。

#### 雲端容量

提供組織內的小組的雲端容量的公司 IT 群組常用的方式是使用 「 t 恤尺寸 」，也就是標準供應項目的大小 
如為小型、 中型和大型。 T 恤尺寸的供應項目可以同時提供標準化層級混合不同資源類型和數量 
仍可使用的範本。 範本會利用容量，強制執行公司原則，並使用標記來提供一致的方式 
若要取用組織計費。

例如，您可能需要提供開發、測試或實際執行環境，讓軟體開發團隊可以在其中部署他們的解決方案。 
這個環境具備預先定義的網路拓撲和軟體開發團隊無法變更，例如公開存取的規則項目 
網際網路和封包檢查。 您也可以針對這些環境，使用不同的環境存取權限來設定組織特定的角色。

#### 雲端裝載功能

您可以使用範本來支援雲端裝載功能，包括個別的軟體套件或提供給內部特定的複合供應項目 
業務。 複合供應項目的範例是分析做為服務 — 分析、 視覺化和其他技術 — 傳遞最佳化， 
預先定義的網路拓撲上連線的設定。

雲端裝載功能會受到建置它們的雲端容量供應項目所建立的安全性和角色考量所影響，如上所述。
這些功能會依原樣提供，或提供來做為受管理的服務。 後者，存取限制的角色所需的環境中啟用存取 
管理目的。

## 雲端服務廠商

在討論許多 CSV 之後，我們找出了多個方法，讓您能夠用來針對客戶及相關聯需求部署服務。

### CSV 裝載的供應項目

如果 Azure 訂閱中裝載您的產品，裝載的兩種方法都有 ︰ 針對每位客戶部署不同的部署或部署 
支持針對所有客戶使用的共用基礎結構的擴充單位。

- **針對每位客戶進行不同的部署。** 針對每位客戶進行不同的部署，需要具備不同已知組態的固定拓撲。 這些可能會有不同 
不同的節點數目，以及相關聯的儲存體的不同數量的虛擬機器 (VM) 大小。 部署的標記可用來彙總每位客戶的帳單。 
系統可能會啟用 RBAC，以允許客戶存取其雲端環境的各個層面。
- **共用多租用戶環境中的縮放單位。** 範本可以代表多租用戶環境的縮放單位。 在此情況下，相同的基礎結構 
用來支援所有的客戶。 部署代表一組提供的容量，裝載供應項目，例如使用者數目的層級的資源 
和交易數目。 這些縮放單位會隨著需求增加或減少。

### CSV 供應項目會插入至客戶訂用帳戶

您可能想要將軟體部署到客戶所擁有的訂用帳戶。 您可以使用範本，部署不同的部署到客戶的 Azure 訂用帳戶。

這些部署會使用 RBAC，因此，您可以在客戶的帳戶內更新和管理部署。

### Azure Marketplace

如果您想要廣告和銷售您透過服務商場，例如 Azure Marketplace 的產品，您就可以開發以提供不同類型的範本 
將客戶的 Azure 帳戶中執行的部署。 這個不同的部署可以通常稱為 t 恤尺寸 （小型、 中型、 大型）， 
產品/對象類型 （社群、 開發人員、 企業版） 或功能類型 （基本、 高可用性）。  在某些情況下，這些類型可讓您指定 
部署，例如 VM 類型或磁碟數目的特定屬性。

## OSS 專案

在開放原始碼專案中，資源管理員範本讓社群能夠使用經過證實的做法，快速部署解決方案。 您可以儲存中的範本 
GitHub 儲存機制讓社群可以修改它們經過一段時間。 使用者接著可在自己的 Azure 訂用帳戶中部署這些範本。

下列各節將識別您在設計解決方案之前需考慮的事項。

## 識別 VM 內部和外部的功能

設計範本時，最好考量虛擬機器 (VM) 內部與外部的相關功能需求：

- 外部表示您部署的 VM 和其他資源，例如，網路拓樸、標記、憑證/密碼的參考，以及角色型存取控制。 所有的這些資源都是您範本的一部分。
- 內部表示已安裝的軟體和整體的期望狀態組態。 其他機制 (例如 VM 延伸模組或指令碼) 可完整使用或部分使用。 範本或許能夠識別和執行這些機制，但這些機制並不存在於範本中。

您可以在「箱子內部」進行的常見活動範例包括如下：  

- 安裝或移除伺服器角色和功能
- 在節點或叢集層級安裝和設定軟體
- 在 Web 伺服器上部署網站
- 部署資料庫結構描述
- 管理登錄或其他類型的組態設定
- 管理檔案和目錄
- 啟動、停止及管理處理程序和服務
- 管理本機群組和使用者帳戶
- 安裝和管理封裝 (.msi、.exe、yum 等等)
- 管理環境變數
- 執行原生指令碼 (Windows PowerShell、bash 等)

### 期望狀態組態 (DSC)

考慮部署以外的 Vm 內部狀態，您會想要確定此部署不中 「 漂移 」 從您所設定 
已定義且已簽入的原始檔控制。 這可確保您的開發人員或操作人員不手動變更臨機操作的環境中，不會驗證， 
測試或記錄中的原始檔控制。 這點很重要，因為手動變更不是原始檔控制中，它們也不是一部分標準部署 
而且還會影響未來的自動化的部署的軟體。

從安全性觀點來看，除了您的內部員工，期望狀態組態也很重要。  駭客會定期嘗試洩漏和惡意探索 
軟體系統。 如果成功，通常就會安裝檔案，否則會變更遭入侵的系統狀態。 您可以使用所需的狀態組態 
識別期望與實際狀態之間的差異，並還原已知的組態。

針對適用於 DSC 的最熱門機制有一些資源擴充功能可供使用 - PowerShell DSC、Chef 及 Puppet。 每一種可部署 VM 的初始狀態， 
也可用來確定會維持期望的狀態。

## 通用範本範圍

在我們的經驗中，我們看到了範圍所浮現的三個主要解決方案範本。 – 容量、 功能和端對端解決方案 – 這三個範圍中所述 
下面詳細。

### 容量範圍

容量範圍可在標準拓樸中提供一組預先設定來遵循法規和原則的資源。 最常見 
範例部署在企業 IT 或 SI 案例中的標準開發環境。

### 功能範圍

功能範圍著重於部署和設定特定技術的拓撲。 常見案例包括 SQL Server 等技術 
Cassandra、 Hadoop 等。

### 端對端解決方案範圍

端對端解決方案範圍的目標已超越單一功能，並改為將重點放在提供由多個功能所組成的端對端解決方案。  

已設定解決方案範圍的範本範圍會將其本身顯示為一組具有一或多個已設定功能範圍的範本，其中含有解決方案特定的資源、邏輯和期望狀態。 解決方案範圍之一是範本的端對端資料管線解決方案範本可能會混合解決方案特定的拓撲和狀態 
多個功能範圍的解決方案範本，例如 Kafka、 Storm 和 Hadoop。

## 選擇自由格式與已知的組態

您一開始可能認為範本應該為取用者提供最大的彈性，但許多考量會影響到選擇是否使用自由格式 
與已知的組態設定。 本節說明主要的客戶需求和共用中的形狀方法的技術考量 
這份文件。

### 自由格式組態

表面上，自由格式組態聽起來很實用。 它們可讓您選取 VM 類型，並提供任意數目的節點，並附加這些節點的磁碟 — 和 
這麼做為範本的參數。 當您仔細，不過，並請考慮將部署多部虛擬機器的大小不同，其他的範本 
考量會出現在許多案例中進行選擇較不適當的。

文件中 [虛擬機器和雲端服務大小](http://msdn.microsoft.com/library/azure/dn641267.aspx) 在 Azure 網站不同的 VM 
識別類型和可用大小和持久的數字的每個磁碟 （2、 4、 8、 16 日 / 32），可以連接。 每個連接的磁碟提供 500 個 IOPS 
可做為乘數的 IOPS 數字的共用這些磁碟的倍數。 例如，共用 16 個磁碟，即可提供 8,000 個 IOPS。 集區是利用 
作業系統在 Linux 中使用 Microsoft Windows 儲存空間或獨立磁碟 (RAID) 的備援陣列中的組態。

自由格式組態可讓您選擇的 VM 執行個體的數目、 不同 VM 類型和大小，這些執行個體數目的磁碟數目， 
可以依 VM 類型，以及一或多個指令碼來設定 VM 內容。

通常，部署可能會有多種類型的節點 (例如主要和資料節點)，因此，經常會針對每個節點類型提供此彈性。

當您開始部署具有任何重要性的叢集時，就會開始使用這所有數目的倍數。 如果您部署的 Hadoop 叢集中，比方說， 
8 個主要節點和 200 個資料節點和集區 4 個連接的磁碟上每個主要節點和每個資料節點的共用連接 16 個磁碟，您會有 208 個 Vm 和 
若要管理的 3232 個磁碟。

儲存體帳戶會節流處理的要求其識別的 20000 交易/秒限制，因此您應該查看儲存體帳戶的資料分割，並使用上述 
若要判斷適當數目的儲存體帳戶，以配合此拓撲的計算。 提供多種支援的自由格式的組合 
方法，決定適當的資料分割是動態計算。 Azure 資源管理員範本語言目前不提供 
數學函式，所以您必須執行這些計算程式碼中，產生唯一的硬式編碼的範本與適當的詳細資料。

在企業 IT 和 SI 案例中，有人必須維護範本，並提供已針對一或多個組織部署之拓撲的支援。 
這個額外負擔 (每位客戶都有不同的組態和範本) 並不盡理想。

您可以使用這些範本部署環境中客戶的 Azure 訂用帳戶，但企業的 IT 團隊和 Csv 通常部署至其 
訂閱自己，使用計費函式向客戶收費。 在這些情況下，目標是要部署多個客戶的容量跨集區 
訂閱和密集地擴展到最小化訂閱的訂閱保留部署蔓延 — 也就是多個訂閱來管理。 與真正 
動態部署大小達到這種類型的密度需要仔細規劃，以及其他開發來代表組織樣版工作。

此外，您無法透過 API 呼叫來建立訂用帳戶，但必須透過入口網站手動執行此動作。 訂用帳戶數目增加時，任何結果 
訂需要使用者介入，根本無法自動化。 如此多變中部署的大小，您必須預先佈建 
提供以手動方式，確保訂閱的訂閱數目。

考慮這所有因素，真正的自由格式組態乍看之下比較不具吸引力。

### 已知組態 - T 恤尺寸調整法

而不是提供範本，可提供總彈性和無數個變化，我們的經驗的常見模式是可讓您選取 
已知組態 — 沙箱、 小型、 中型和大型等標準 t 恤尺寸的作用中。 T 恤尺寸的其他範例包括產品供應項目， 
例如社群版本或企業版。  在其他情況下，這可能是某種技術的工作負載特定組態， 例如，對應減少或沒有 SQL。

許多企業 IT 組織、 OSS 廠商和 Si 將其供應項目目前可用，如此一來在內部，虛擬化環境 
（企業） 或軟體做為服務 (SaaS) 供應項目 （Csv 和 Osv）。

這種方法可針對預先為客戶設定好的各種大小提供良好且已知的組態。 如果沒有已知的組態，最後客戶 
必須判斷叢集上的平台資源限制，自行利用，比例的調整大小，並進行數學運算來識別產生分割的儲存體帳戶 
和其他資源 （因為叢集大小和資源限制）。 已知組態讓客戶能夠輕鬆選取正確的 t 恤大小 — 亦即 
指定的部署。 除了為客戶更好的經驗，少量的已知組態會更容易支援，可協助您 
將傳遞較高層級的密度。

著重於 T 恤尺寸的已知組態方法在某個尺寸內可能也會擁有各種節點數目。 例如，可能是小型的 t 恤尺寸 
介於 3 到 10 個節點。  T 恤尺寸被設計來容納最多 10 個節點，並讓取用者能夠進行最多的自由格式選取 
識別的大小上限。  

根據工作負載類型 t 恤尺寸可能更多的自由格式中，您可以部署，但會有不同的工作負載的節點數目方面本質 
節點大小與組態的節點上的軟體。

根據產品供應項目，例如社群或企業，t 恤尺寸可能會有不同的資源類型和可部署的節點數目上限 
通常受限於授權考量或功能可用性跨不同供應項目。

您也可以使用以 JSON 為基礎的範本，利用獨特的變體來配合客戶。 當處理極端值，您可以將適當的規劃 
與開發、 支援和成本的考量。

根據客戶範本取用案例、 本文件中，與建立的許多範本，我們實際操作經驗的一開始所識別的需求 
我們找出範本分解的模式。

## 已設定容量和功能範圍的解決方案範本

分解可提供範本開發的模組化方法，以支援重複使用、擴充性、測試和工具設定。 本節提供有關的詳細資料 
分解方法可以套用到具有容量或功能範圍的範本。

這種方法，主要的範本會從範本取用者收到參數值然後數種類型的範本和下游指令碼做為連結 
如下所示。 參數、靜態變數和產生的變數可用來提供進出連結範本的值。

![範本參數](./media/best-practices-resource-manager-design-templates/template-parameters.png)

**參數會傳遞到主要的範本，然後傳遞到連結的範本**

以下各節著重在類型的範本和指令碼會分解單一範本，並且會檢查傳遞狀態的方法 
範本之間的資訊。 此圖中的每個範本和指令碼類型都會使用範例來說明。 如需內容相關的範例，請參閱 
「 整合在一起 ︰ 範例實作 「 稍後在本文件中。

### 範本中繼資料

範本中繼資料 (metadata.json 檔案) 包含使用 JSON 說明範本的機碼/值組，讓人類和軟體系統都能讀取該範本。

![範本中繼資料](./media/best-practices-resource-manager-design-templates/template-metadata.png)

**範本中繼資料的說明位於 metadata.json 檔案中**

軟體代理程式可以擷取 metadata.json 檔案，並將資訊和連結發佈到網頁或目錄中的範本。 項目 
包含 *itemDisplayName*, ，*描述*, ，*摘要*, ，*githubUsername*, ，和 *dateUpdated*。

以下顯示完整的範例檔案。

    {
        "itemDisplayName": "PostgreSQL 9.3 on Ubuntu VMs",
        "description": "This template creates a PostgreSQL streaming-replication between a master and one or more slave servers each with 2 striped data disks. The database servers are deployed into a private-only subnet with one publicly accessible jumpbox VM in a DMZ subnet with public IP.",
        "summary": "PostgreSQL stream-replication with multiple slave servers and a publicly accessible jumpbox VM",
        "githubUsername": "arsenvlad",
        "dateUpdated": "2015-04-24"
    }

### 主要的範本

主要的範本 (azuredeploy.json 檔案) 是由使用者呼叫，而且是透過它提供一組使用者定義參數的範本。

![主要的範本](./media/best-practices-resource-manager-design-templates/main-template.png)

**主要的範本會接收來自使用者的參數**

此範本的角色是接收來自使用者的參數，請使用該資訊填入一組複雜物件變數，然後執行適當 
使用範本連結的相關範本組。

提供一個參數是已知的組態類型也稱為 t 恤尺寸參數，因為其標準化的值，例如小型的 
中型或大型。 實際上，您可以多種方式來使用此參數。 如需詳細資訊，請參閱本文件稍後的＜已知組態資源範本＞。

無論使用者參數所指定的已知組態為何，都會部署某些資源。 這些資源會使用單一共用佈建 
資源範本和都是由共用其他範本，共用的資源範本就會執行第一次。

不論指定的已知組態為何，都會選擇性地部署某些資源。

### 共用的資源範本

此範本會提供所有已知組態上通用的資源。 它包含虛擬網路、 可用性設定組，以及其他資源， 
不論部署的已知的組態範本需要的。

![範本資源](./media/best-practices-resource-manager-design-templates/template-resources.png)

**共用的資源範本**

資源名稱 (例如虛擬網路名稱) 會以主要的範本為根據。 您可以將其指定為該範本內的變數，或接收它們做為 
參數的使用者、 所需的組織。

### 選擇性資源範本

選擇性資源範本包含以參數或變數的值為根據且利用程式設計方式部署的資源。

![選擇性資源](./media/best-practices-resource-manager-design-templates/optional-resources.png)

**選擇性資源範本**

例如，您可以使用選擇性資源範本來設定 jumpbox，可讓您間接存取部署的環境免於公開 
網際網路。 您可以使用參數或變數來識別是否應啟用 jumpbox 和 *concat* 函式來建置的目標名稱 
範本，例如 *jumpbox_enabled.json*。 範本連結會使用產生的變數來安裝 Jumpbox。

您可以從多個位置連結選擇性資源範本：

-   若適用於每個部署，即可從共用的資源範本建立參數導向的連結。
-   適用於選取已知的組態時 — 例如，只會在大型部署上安裝 — 建立參數導向或變數導向的連結 
已知的組態範本。

指定的資源是否為選擇性，可能不是由範本取用者所驅動，而是由範本提供者所驅動。 例如，您可能需要滿足 
特定產品需求或產品附加元件 （通常適用於 Csv） 或強制執行原則 (適用於 Si 與企業 IT 通用群組)。 在這些情況下，您可以使用 
識別是否應該部署資源的變數。

### 已知組態資源範本

在主要的範本中，參數會公開，讓範本取用者能夠指定要部署的期望已知組態。 在許多情況下，這稱為 
組態會使用一組固定的組態大小，例如沙箱、 小型、 中型和大型的 t 恤尺寸方法。

![已知組態資源](./media/best-practices-resource-manager-design-templates/known-config.png)

**已知組態資源範本**

通常會使用 T 恤尺寸方法，但參數可代表任何已知組態的組合。 例如，您可以指定一組環境 
例如，開發、 測試和產品企業應用程式。 您可以使用它的雲端服務來代表不同的縮放單位，產品版本，或 
或產品組態，例如社群、 Developer 或 Enterprise。

如同共用的資源範本，變數會從下列任一處傳遞到已知組態範本：

-   使用者 - 也就是傳送到主要範本的參數。
-   組織 - 也就是主要範本中代表內部需求或原則的變數。

### 成員資源範本

在已知組態中，通常會包含一或多個成員節點類型。 例如，使用 Hadoop，您會有主要節點和資料節點。 
如果正在安裝 MongoDB，則會有資料節點和仲裁程式。 如果您正在部署 DataStax，就必須資料節點，以及 VM 
已安裝 opscenter。

![成員資源](./media/best-practices-resource-manager-design-templates/member-resources.png)

**成員資源範本**

每一種節點可以有不同大小的 Vm，連接的磁碟，指令碼，以安裝並設定節點的 VM，設定連接埠的數字 
執行個體數目和其他詳細資料。 因此每個節點類型都會取得自己的成員資源範本，其中包含部署和設定的詳細資料 
基礎結構，以及執行指令碼來部署和設定的 VM 內的軟體。

針對 VM，通常會使用兩種類型的指令碼：廣泛可重複使用和自訂的指令碼。

### 廣泛可重複使用的指令碼

廣泛可重複使用的指令碼可以在多種類型的範本上使用。 其中一個更好的範例，這些廣泛可重複使用的指令碼設定要在 Linux 上的 RAID 
共用磁碟，並取得更多的 IOPS。 不論 VM 中安裝了哪種軟體，此指令碼都會針對常見案例重複使用經過證實的做法。

![可重複使用的指令碼](./media/best-practices-resource-manager-design-templates/reusable-scripts.png)

**成員資源範本能夠呼叫廣泛可重複使用的指令碼**

### 自訂指令碼

範本通常會呼叫一或多個指令碼，在 VM 內安裝和設定軟體。 常見的模式出現在大型拓撲其中多個 
部署一或多個成員類型的執行個體。 安裝指令碼可以執行以平行方式，針對每個 vm 起始後面安裝指令碼 
部署所有 Vm （或指定的成員類型的所有 Vm） 之後，會呼叫的項目。

![自訂指令碼](./media/best-practices-resource-manager-design-templates/custom-scripts.png)

**成員資源範本可基於特定目的呼叫指定碼，例如 VM 組態**

## 已設定功能範圍的解決方案範本範例 - Redis

若要顯示實作可能的方式運作，讓我們看看建置範本，將有助於進行部署和設定的實際範例 
在標準的 t 恤尺寸的 redis。  

針對部署，將會有一組共用資源 (虛擬網路、儲存體帳戶、可用性設定組) 和一個選擇性資源 (Jumpbox)。 有 
表示為 t 恤尺寸 （小型、 中型、 大型） 的多個已知的組態，但每個都有單一節點類型。 另外還有兩個目的特定指令碼 
（安裝、 設定）。

### 建立範本檔案

您會建立名為 azuredeploy.json 的主要範本。

您會建立名為 shared-resources.json 的共用資源範本

您會建立選擇性資源範本來啟用 Jumpbox 的部署 (名為 jumpbox_enabled.json)

Redis 只會使用單一節點類型，因此您將建立名為 node-resources.json 的單一成員資源範本。

使用 Redis，您會想要安裝每個個別的節點，接著，並且在安裝所有節點之後，會想要設定叢集。  您有指令碼 
容納這兩種，redis-install.sh 和 redis-setup.sh。

### 連結範本

使用範本連結時，主要的範本會向外連結到共用的資源範本，以建立虛擬網路。

邏輯會新增到主要的範本內，讓範本的取用者能夠指定是否應該部署 Jumpbox。  *啟用* 值 *EnableJumpbox* 
參數表示客戶想要部署 jumpbox。 提供此值時，範本會串連 *_enabled* 做基底範本的尾碼 
名稱為 jumpbox 功能的。

主要的範本適用於 *大型* 參數的值將做為 t 恤尺寸，然後使用基底範本名稱的尾碼中的範本連結時的值 
*technology_on_os_large.json*。

拓撲會類似下圖。

![Redis 範本](./media/best-practices-resource-manager-design-templates/redis-template.png)

**Redis 範本的範本結構**

### 設定狀態

在叢集中的節點，有兩個步驟來設定狀態，表示特定用途的指令碼。  將 「 redis-install.sh" 
執行 Redis 的安裝，並且 「 redis-setup.sh"將設定叢集。

### 支援不同大小的部署

在變數內部，t 恤尺寸的範本指定的每個要針對特定大小的部署類型的節點數目 (*大型*)。 接著，部署數的字 
使用資源迴圈，將節點名稱加上數字序號，從提供的資源的唯一名稱的 VM 執行個體 *copyindex （)*。 它會針對 
兩者熱延遲和暖區的 Vm，t 恤名稱範本中所定義

## 分解和已設定端對端解決方案範圍的範本

具有端對端解決方案範圍的解決方案範本會將重點放在提供端對端解決方案。  這通常是多個功能的組合 
與其他資源、 邏輯和狀態已設定領域的範本。

如下圖中反白顯示的，同樣適用於已設定功能範圍之範本的模型，會針對具有端對端解決方案範圍的範本加以擴充。

共用資源範本和選擇性資源範本提供容量中相同的功能和功能範圍的範本方法，但會 
端對端解決方案範圍內。

已知組態資源範本為端對端解決方案範圍範本通常也會有 t 恤尺寸，反映的需要 
指定的方案的已知的組態。

已知組態資源範本將連結到一或多個功能範圍的端對端解決方案相關的方案範本 
成員資源範本所需的端對端解決方案。

T 恤方案的大小可能會不同，個別的功能範圍的範本，已知組態資源內的變數 
範本用來提供所需的下游已設定功能範圍的解決方案範本部署適當的 t 恤大小適當的值。

![端對端](./media/best-practices-resource-manager-design-templates/end-to-end.png)

**適用於已設定容量或功能範圍之解決方案範本的模型可針對端對端解決方案範本範圍輕易地進行擴充**

## 準備適用於 Marketplace 的範本

上述的方法可輕易地配合企業、 Si 和 Csv 想要部署範本本身，或讓客戶的地方的案例 
自行部署。

另一個所需的案例是透過 Marketplace 來部署範本。  這個分解方法也適用於 Marketplace，但會有些微變更。

如先前所述，範本可用來提供不同的部署類型，以便在 Marketplace 中進行銷售。 可能是不同的部署類型 
t 恤尺寸 （小型、 中型、 大型）、 產品/對象類型 （社群、 開發人員、 企業版） 或功能類型 （基本、 高可用性）。

如下所示，您可以輕鬆地利用現有的端對端解決方案或已設定功能範圍的範本，在 Marketplace 中列出不同的已知組態。

主要範本的參數會先加以修改，以移除名為 tshirtSize 的輸入參數。

不同的部署類型會對應到已知組態資源範本，他們也需要通用資源和組態中找到 
共用資源範本，而可能選擇性資源範本。

如果您想要將範本發佈至 marketplace，只需建立不同的主要範本，它會取代先前提供的複本 
內嵌在範本中變數的 tshirtSize 輸入的參數。

![Marketplace](./media/best-practices-resource-manager-design-templates/marketplace.png)

**針對 Marketplace 調整已設定解決方案範圍的範本**

## 後續步驟

- 若要查看如何實作本主題提供的設計原理的內容範例，請參閱 [實作範本最佳做法內容範例](best-practices-resource-manager-examples.md)。
- 如需有關如何在 Azure 資源管理員的安全性建議，請參閱 [Azure 資源管理員的安全性考量](best-practices-resource-manager-security.md)
- 若要深入了解進出範本的共用狀態，請參閱 [Azure 資源管理員範本中的共用狀態](best-practices-resource-manager-state.md)。


