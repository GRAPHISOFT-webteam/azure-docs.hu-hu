<properties
   pageTitle="使用 Azure Tools 發佈雲端服務 | Microsoft Azure"
   description="了解如何使用 Visual Studio 發佈 Azure 雲端服務專案。"
   services="visual-studio-online"
   documentationCenter="na"
   authors="TomArcher"
   manager="douge"
   editor="" />
<tags
   ms.service="multiple"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="multiple"
   ms.date="09/04/2015"
   ms.author="tarcher" />

# 使用 Azure Tools 發佈雲端服務

您可以使用 Azure Tools for Microsoft Visual Studio，直接從 Visual Studio 發佈 Azure 應用程式。 Visual Studio 支援以整合方式發佈至雲端服務的預備或生產環境。

您必須具有 Azure 訂用帳戶才可以發佈 Azure 應用程式。 您也必須設定要供應用程式使用的雲端服務和儲存體帳戶。 您可以設定這些在 [Azure 管理入口網站](http://go.microsoft.com/fwlink/?LinkID=213885)。

>[AZURE.IMPORTANT] 發行時，您可以為您的雲端服務選取部署環境。 您也必須選取用來儲存部署所需應用程式套件的儲存體帳戶。 在部署後，就會從儲存體帳戶移除應用程式套件。 如需如何設定這些服務的詳細資訊，請參閱 [設定服務需要設定發行雲端服務](vs-azure-tools-setting-up-services-required-to-publish-a-cloud-service-from-visual-studio.md) 從 Visual Studio。

在開發和測試 Azure 應用程式時，可以使用 Web Deploy 以累加方式對 Web 角色發佈變更。 在將應用程式發佈至部署環境後，Web Deploy 可讓您直接將變更部署至執行 Web 角色的虛擬機器。 您不必在每次想要更新 Web 角色以測試變更時封裝和發佈整個 Azure 應用程式。 透過這個方法，即可在雲端提供 Web 角色變更來進行測試，而不必等到應用程式發佈至部署環境後才進行。

請使用下列程序來發佈 Azure 應用程式以及利用 Web Deploy 更新 Web 角色：

- 從 Visual Studio 發佈或封裝 Azure 應用程式

- 在開發和測試週期期間更新 Web 角色

## 從 Visual Studio 發佈或封裝 Azure 應用程式

在發佈 Azure 應用程式時，可以執行下列其中一項工作：

- 建立服務封裝 ︰ 您可以使用此套件和服務組態檔來發行您的應用程式的部署環境，從 [Azure 管理入口網站](http://go.microsoft.com/fwlink/?LinkID=213885)。

- 從 Visual Studio 發佈 Azure 專案：若要將應用程式直接發佈至 Azure，您可以使用 [發佈精靈]。 如需資訊，請參閱 [發行 Azure 應用程式精靈](vs-azure-tools-publish-azure-application-wizard.md)。

### 從 Visual Studio 建立服務封裝

1. 準備好發佈應用程式時，請開啟 [方案總管]，開啟包含角色的 Azure 專案的捷徑功能表，然後選擇 [發佈]。

1. 若只要建立服務封裝，請遵循下列步驟：  

  1. 在 Azure 專案的捷徑功能表，選擇 [ **封裝**。

  1. 在 **封裝 Azure 應用程式** 對話方塊中，選擇您要建立封裝時，服務組態，然後選擇 [組建組態。

  1. （選擇性）若要開啟遠端桌面的雲端服務發行後，請選取 **啟用所有角色的遠端桌面** 核取方塊，，然後按一下 [ **設定** 來設定遠端桌面。 如果您想要偵錯雲端服務，在您發行它之後，開啟所選取的遠端偵錯 **啟用遠端偵錯工具的所有角色**。

      如需詳細資訊，請參閱 [與 Azure 角色使用遠端桌面](vs-azure-tools-using-remote-desktop-with-azure-roles.md)。

  1. 若要建立封裝時，選擇 [ **封裝** 連結。

      [檔案總管] 會顯示新建立之封裝的檔案位置。 您可以複製這個位置，以從 Azure 管理入口網站使用它。

  1. 若要將此套件發行至部署環境，您必須使用這個位置為封裝位置當您建立雲端服務，並將此封裝部署的環境 [Azure 管理入口網站](http://go.microsoft.com/fwlink/?LinkID=213885)。

1. （選擇性）若要取消部署程序，在活動記錄檔項目的捷徑功能表上的選擇 **取消並移除**。 這會停止部署程序，並從 Azure 中刪除部署環境。

    >[AZURE.NOTE] 若要完成部署後，請移除這個部署環境，您必須使用 Azure 管理入口網站。

1. （選擇性）您的角色執行個體啟動之後，Visual Studio 會自動顯示部署環境中的 **雲端服務** 伺服器總管] 中的節點。 您可以從這裡檢視個別角色執行個體的狀態。 請參閱 [雲端總管管理 Azure 資源](vs-azure-tools-resources-managing-with-cloud-explorer.md)。下圖顯示角色執行個體時仍處於初始化狀態 ︰

    ![VST_DeployComputeNode](./media/vs-azure-tools-publishing-a-cloud-service/IC744134.png)

## 在開發和測試週期期間更新 Web 角色

如果您的應用程式有穩定的後端基礎結構，但 Web 角色需要更頻繁的更新，您可以使用 Web Deploy，僅更新專案中的 Web 角色。 當您不想要重建並重新部署後端背景工作角色，或如果您有多個 Web 角色但只想要更新其中一個 Web 角色，這個方法就能派上用場。

### 需求

以下是使用 Web Deploy 更新 Web 角色的需求：

- **僅供開發和測試用途 ︰** 變更直接到虛擬機器正在 web 角色。 如果此虛擬機器必須回收，您就會遺失變更，因為您發佈的原始封裝會用來重新建立角色的虛擬機器。 您必須重新發佈應用程式以取得 Web 角色的最新變更。

- **只有 web 角色可以更新 ︰** 無法更新背景工作角色。 此外，您無法更新 web role.cs 中的 RoleEntryPoint。

- **只能支援 web 角色的單一執行個體 ︰** 部署環境中不能有任何 web 角色的多個執行個體。 不過，可支援多個各只有一個執行個體的 Web 角色。

- **您必須啟用遠端桌面連線 ︰** 這是必要的好讓 Web 部署可以使用使用者名稱和密碼來連接到虛擬機器，將變更部署到執行網際網路資訊服務 (IIS) 伺服器。 此外，您可能需要連線到虛擬機器，以將信任的憑證新增到此虛擬機器上的 IIS。 (這可確保 Web Deploy 所使用的 IIS 的遠端連線安全無虞。)

下列程序假設您正在使用 **發行 Azure 應用程式** 精靈。

### 在發佈應用程式時啟用 Web Deploy

1. 若要啟用 **啟用 Web Deploy** 所有 web 角色] 核取方塊，您必須先設定遠端桌面連線。 選取 **啟用遠端桌面** 所有角色，然後提供的認證將用於從遠端在連接 **遠端桌面設定** 出現方塊。 請參閱 [與 Azure 角色使用遠端桌面](vs-azure-tools-remote-desktop-roles.md) 如需詳細資訊。

1. 若要啟用 Web Deploy 應用程式中的所有 web 角色，請選取 **所有 web 角色都啟用 Web 都 Deploy**。

    此時會出現黃色警告三角形。 Web Deploy 預設會使用不受信任的自我簽署憑證，在上傳機密資料時不建議使用此憑證。 如果您需要確保機密資料在進行此程序時安全無虞，可以新增 SSL 憑證以用於 Web Deploy 連線。 此憑證必須是受信任的憑證。 如需如何執行這項操作，請參閱一節 **來進行 Web 部署安全** 稍後在本主題中。

1. 選擇 **下一步** 顯示 **摘要** 畫面上，然後按一下 **發行** 部署雲端服務。

    雲端服務隨即進行發佈。 所建立的虛擬機器已啟用遠端連線的 IIS 功能，因此可以使用 Web Deploy 來更新 Web 角色，而不必重新發佈。

    >[AZURE.NOTE] 如果您有多個 web 角色設定的執行個體時，會出現警告訊息，指出每個 web 角色會限制只能在建立要發行應用程式的封裝中的一個執行個體。 按一下 [確定] 以繼續。 如＜需求＞一節所述，您可以有多個 Web 角色，但每個角色只能有一個執行個體。

### 使用 Web Deploy 更新 Web 角色

1. 若要使用 Web Deploy，對程式碼變更為任何您想要發佈，然後以滑鼠右鍵按一下此方案中的專案節點，並指向的 Visual Studio 中的 web 角色專案 **發行**。  **發行 Web** ] 對話方塊隨即出現。

1. （選擇性）如果您新增受信任的 SSL 憑證，用於 IIS 的遠端連線，您可以清除 **允許不受信任的憑證** 核取方塊。 如需如何新增憑證以進行 Web 部署的安全資訊，請參閱一節 **來進行 Web 部署安全** 稍後在本主題中。

1. 若要使用 Web Deploy，發佈機制會需要您首先發佈封裝時針對遠端桌面連線所設定的使用者名稱和密碼。

  1. 在 **使用者名稱**, ，輸入使用者名稱。

  1. 在 **密碼**, ，輸入密碼。

  1. （選擇性）如果您想要將此密碼儲存在此設定檔中，選擇 [ **儲存密碼**。

1. 若要將變更發行至 web 角色中，選擇 [ **發行**。

    狀態列會顯示 **發行啟動**。 當發行完成之後時， **成功發行** 隨即出現。 現在變更已部署至虛擬機器上的 Web 角色。 您現在可以在 Azure 環境中啟動 Azure 應用程式來測試變更。

### 讓 Web Deploy 安全無虞

1. Web Deploy 預設會使用不受信任的自我簽署憑證，在上傳機密資料時不建議使用此憑證。 如果您需要確保機密資料在進行此程序時安全無虞，可以新增 SSL 憑證以用於 Web Deploy 連線。 此憑證必須是從憑證授權單位 (CA) 取得的受信任憑證。

    若要讓 Web 部署安全的每部虛擬機器每個 web 角色，您必須上傳您想要用於 web 的受信任的憑證部署至 [Azure 管理入口網站](http://go.microsoft.com/fwlink/?LinkID=213885)。 如此可確保在您發佈應用程式時，針對 Web 角色所建立的虛擬機器中會新增此憑證。

1. 若要將受信任的 SSL 憑證新增至 IIS 以用於遠端連線，請遵循下列步驟：

  1. 若要連接至虛擬機器正在執行 web 角色，按一下 [執行個體中的 web 角色 **雲端總管** 或 **伺服器總管**, ，然後選擇 [ **使用遠端桌面連線** 命令。 如需如何連接至虛擬機器的詳細步驟，請參閱 [與 Azure 角色使用遠端桌面](vs-azure-tools-remote-desktop-roles.md)。

      瀏覽器會提示您下載 .RDP 檔案。

  1. 若要新增 SSL 憑證，請開啟 IIS 管理員中的管理服務。 在 IIS 管理員中，開啟 [啟用 SSL **繫結** 中連結 **動作** 窗格。  **新增網站繫結** ] 對話方塊隨即出現。 選擇 **新增**, ，然後選擇 [在 HTTPS **類型** 下拉式清單中。 在 **SSL 憑證** 清單中，選擇已由 CA 簽署並上傳至 Azure 管理入口網站的 SSL 憑證。 如需詳細資訊，請參閱 [設定管理服務的連線設定](http://go.microsoft.com/fwlink/?LinkId=215824)。

      >[AZURE.NOTE] 如果您新增受信任的 SSL 憑證，在不會再出現黃色警告三角形 **發行精靈**。

## 將檔案納入服務封裝

您可能需要在服務封裝中納入特定檔案，以在為角色建立的虛擬機器上提供使用。 例如，您可以在服務封裝中加入啟動指令碼所使用的 .exe 或 .msi 檔案。 或者您可能需要加入 Web 角色或背景工作角色專案所需的組件。 若要納入檔案，必須將檔案加入 Azure 應用程式的方案中。

### 將檔案納入服務封裝

1. 若要將組件加入服務封裝中，請使用下列步驟：

  1. 在 **方案總管] 中** 開啟遺漏參考組件的專案的專案節點。

  1. 若要將組件加入至專案中，開啟捷徑功能表 **參考** 資料夾，然後選擇 [ **加入參考**。 [加入參考] 對話方塊隨即出現。

  1. 選擇您想要加入，然後選擇 [參考 **確定** ] 按鈕。

      參考會加入至下方的清單 **參考** 資料夾。

  1. 開啟您所加入的組件的捷徑功能表，然後選擇 **屬性**。  **屬性** ] 視窗隨即出現。

      要包含在服務封裝中，這個組件中 **複製到本機清單** 選擇 **True**。

1. 在 **方案總管] 中** 開啟遺漏參考組件的專案的專案節點。

1. 若要將組件加入至專案中，開啟捷徑功能表 **參考** 資料夾，然後選擇 [ **加入參考**。  **加入參考** ] 對話方塊隨即出現。

1. 選擇您想要加入，然後選擇 [參考 **確定** ] 按鈕。

    參考會加入至下方的清單 **參考** 資料夾。

1. 開啟您所加入的組件的捷徑功能表，然後選擇 **屬性**。 [屬性] 視窗隨即出現。

1. 要包含在服務封裝中，這個組件中 **複製到本機** 清單中，選擇 **True**。

1. 若要在服務封裝中已加入至 web 角色專案中包含檔案，開啟檔案的捷徑功能表，然後選擇 [ **屬性**。 從 **屬性** ] 視窗中，選擇 [ **內容** 從 **建置動作** 清單方塊。

1. 若要在服務封裝中已新增至背景工作角色專案中包含檔案，開啟檔案的捷徑功能表，然後選擇 [ **屬性**。 從 **屬性** ] 視窗中，選擇 [ **才複製** 從 **複製到輸出目錄** 清單方塊。

## 後續步驟

若要深入了解發佈至 Azure 從 Visual Studio，請參閱 [發行 Azure 應用程式精靈](vs-azure-tools-publish-azure-application-wizard.md)。


