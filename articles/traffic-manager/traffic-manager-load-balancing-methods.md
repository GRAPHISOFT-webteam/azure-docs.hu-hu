<properties 
   pageTitle=" 流量管理員 - 流量路由方法 | Microsoft Azure"
   description="本文將協助您了解流量管理員所使用的不同流量路由方法"
   services="traffic-manager"
   documentationCenter=""
   authors="joaoma"
   manager="carmonm"
   editor="tysonn" />
<tags 
   ms.service="traffic-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="12/01/2015"
   ms.author="joaoma" />

# 流量管理員路由方法

在流量管理員中可以使用的流量路由方法有三種。 雖然您可以隨時為設定檔選取不同的流量路由方法，但每個流量管理員設定檔一次只能使用一種流量路由方法。

請務必注意所有的流量路由方法都包括端點監視。 設定您的流量管理員設定檔，並指定最適合您需求的流量路由方法之後，請進行監視設定。 已正確設定監視之後，流量管理員會監視包含雲端服務和網站的端點狀態，並且不會將流量傳送到認定無法使用的端點。 如需流量管理員監視資訊，請參閱 [關於流量管理員監視](traffic-manager-monitoring.md)。 

這三種流量管理員流量路由方法包括：

- **容錯移轉**: 您的端點位於相同或不同 Azure 資料中心 (也就是在 Azure 入口網站中的區域)，且想要讓所有流量，都使用主要端點，但提供備份以防主要或備份端點無法使用時，選取 [容錯移轉。 如需詳細資訊，請參閱 [容錯移轉流量路由方法](#failover-traffic-routing-method)。

- **循環配置資源**: 選取您想要一組端點位於相同資料中心或跨越不同的資料中心分配負載時的循環配置資源。 如需詳細資訊，請參閱 [循環配置資源流量路由方法](#round-robin-traffic-routing-method)。

- **效能**: 選取您在不同地理位置擁有端點，且您想要使用的 「 最靠近 」 的端點，根據最低延遲要求用戶端時的效能。 如需詳細資訊，請參閱 [效能流量路由方法](#performance-traffic-routing-method)。

請注意，不論網站模式為何，Azure 網站已為資料中心內的網站提供容錯移轉和循環配置資源流量路由方法功能。 流量管理員可讓您在不同的資料中心網站中指定容錯移轉和循環配置資源流量路由。

>[AZURE.NOTE] DNS--存留時間 (TTL) 會通知 DNS 用戶端和快取解析的名稱要多久的 DNS 伺服器上的解析程式。 用戶端在解析其網域名稱時將繼續使用指定的端點，直到本機 DNS 快取名稱的項目過期為止。

## 容錯移轉流量路由方法

組織通常會想要為其服務提供可靠性。 這樣做的方法是透過提供備份服務，以避免發生其主要服務當機的情況。 服務容錯移轉的一個常見模式是提供一組完全相同的端點，並將流量連同一或多個備份清單傳送到主要服務。 如果主要服務無法使用，則要求用戶端會被轉介給順序中的下一個服務。 如果清單中的第一個和第二個服務都無法使用，則系統會將流量傳送至第三個服務，依此類推。

設定 [容錯移轉] 流量路由方法時，選取端點的順序非常重要。 使用 Azure 入口網站，您可以在設定檔的 [組態] 頁面上設定容錯移轉順序。

圖 1 顯示一組端點的容錯移轉流量路由方法範例。

![流量管理員容錯移轉負載平衡](./media/traffic-manager-load-balancing-methods/IC750592.jpg)

**圖 1**

下列步驟編號會對應至圖 1 的數字。

1. 流量管理員會收到用戶端透過 DNS 送出的連入要求，並找到設定檔。
2. 設定檔包含已排序的端點清單。 流量管理員會檢查哪一個端點排在清單中的第一個位置。 如果端點處於線上狀態 (根據持續的端點監視)，它會在給用戶端的 DNS 回應中指定該端點的 DNS 名稱。 如果端點處於離線狀態，流量管理員會判斷清單中的下一個線上端點。 在此範例中，CS-A 處於離線狀態 (無法使用)，但是 CS-B 處於線上狀態 (可以使用)。
3. 流量管理員會將 CS B 的網域名稱傳送至用戶端的 DNS 伺服器，DNS 伺服器可將網域名稱解析成 IP 位址，並將它傳送給用戶端。
4. 用戶端會起始流量進入 CS-B。

## 循環配置資源流量路由方法

常見的流量路由模式提供一組完全相同的端點，並以循環配置資源方式將流量傳送到每一個代管服務。 循環配置資源方法會分割不同端點的流量。 它會隨機選取狀況良好的端點，且不會將流量傳送至偵測為已關閉的服務。 如需詳細資訊，請參閱 [流量管理員監視](../traffic-manager-onitoring.md)。

圖 2 顯示一組端點的循環配置資源流量路由方法範例。

![流量管理員循環配置資源負載平衡](./media/traffic-manager-load-balancing-methods/IC750593.jpg)

**圖 2**

下列步驟編號會對應至圖 2 的數字。

1. 流量管理員會收到用戶端的連入要求，並找到設定檔。
2. 設定檔包含端點清單。 視流量管理員端點監視而定，流量管理員會從這份清單隨機選取端點，但不包括任何離線 (無法使用) 端點。 在此範例中會是端點 CS-B。
3. 流量管理員會將 CS-B 的網域名稱傳回給用戶端的 DNS 伺服器。 用戶端的 DNS 伺服器會將該網域名稱解析為 IP 位址，並傳送至用戶端。
4. 用戶端會起始流量進入 CS-B。

循環配置資源流量路由也支援網路流量的加權分配。 圖 3 顯示一組端點的加權循環配置資源流量路由方法範例。

![循環配置資源加權負載平衡](./media/traffic-manager-load-balancing-methods/IC750594.png)

**圖 3**

循環配置資源加權流量路由可讓您將負載分配到不同端點，視每個端點的指定權數值而定。 權數越高，傳回端點的頻率就越高。 適用此方法的案例包括：

- 應用程式逐步升級：配置要路由傳送到新端點的流量百分比，並隨時間逐漸增加流量到 100%。
- 應用程式移轉至 Azure：建立包含 Azure 和外部端點的設定檔，並指定要路由傳送至每個端點的流量權數。
- 額外容量的雲端負載平衡：將內部部署快速展開到雲端的方式是將它放在流量管理員設定檔後面。 當您需要在雲端中增加額外容量時，您可以新增或啟用更多的端點並指定進入每個端點的流量比例。

在此階段中，您無法使用 Azure 入口網站來設定加權流量路由。 Azure 提供以程式設計的方式存取此方法，方法是使用相關聯的服務管理 REST API 和 Azure PowerShell Cmdlet。

使用 REST Api 的相關資訊，請參閱 [流量管理員的相關作業 (REST API 參考)](http://go.microsoft.com/fwlink/p/?LinkId=313584)。

使用 Azure PowerShell cmdlet 的相關資訊，請參閱 [Azure 流量管理員 Cmdlet](http://go.microsoft.com/fwlink/p/?LinkId=400769)。 如需組態範例，請參閱 [Azure 流量管理員外部端點和透過 PowerShell 的加權循環](http://azure.microsoft.com/blog/2014/06/26/azure-traffic-manager-external-endpoints-and-weighted-round-robin-via-powershell/) Azure 部落格中。

若要測試單一用戶端的設定檔，並觀察相等或加權的循環配置資源行為，請確認已根據設定檔中的相等或加權值，將 DNS 名稱解析成不同的端點 IP 位址。 測試時，您必須停用用戶端 DNS 快取或清除每次嘗試之間的 DNS 快取，以確保送出新的 DNS 名稱查詢。

## 效能流量路由方法

為了能夠流量路由位於全球不同資料中心內的端點，您可以根據要求用戶端與端點之間的最低延遲，將連入流量導向最靠近的端點。 通常，「最靠近」的端點會直接對應到最短的地理距離。 效能流量路由方法可讓您根據位置和延遲進行分配，但無法考量在網路組態或負載中的即時變更。

效能流量路由方法會找出要求用戶端，並將它轉介給最靠近的端點。 「接近程度」 會取決於網際網路延遲資料表，顯示各個 IP 位址與每個 Azure 資料中心之間的往返時間。 此資料表會定期更新，且不會即時反映網際網路上的效能。 雖然流量管理員會根據您選擇的方法監視端點，且 DNS 查詢回應將不會納入無法使用的端點，它仍不會將給定服務的負載納入考量。 換言之，效能流量路由也整合了容錯移轉流量路由方法。

圖 4 顯示一組端點的效能流量路由方法範例。

![流量管理員效能負載平衡](./media/traffic-manager-load-balancing-methods/IC753237.jpg)

**圖 4**

下列步驟編號會對應至圖 4 的數字。

1. 流量管理員會定期建立網際網路延遲資料表。 流量管理員基礎結構會執行測試，以判斷世界上不同地點和託管端點的 Azure 資料中心之間的往返時間。
2. 流量管理員會收到客戶端透過其本機 DNS 伺服器送出的連入要求，並找到設定檔。
3. 流量管理員會在網際網路延遲資料表中，找到傳入 DNS 要求之 IP 位址的資料列。 因為使用者的本機 DNS 伺服器會執行反覆 DNS 查詢來尋找流量管理員設定檔名稱的授權 DNS 伺服器，所以此 DNS 查詢會從用戶端本機 DNS 伺服器的 IP 位址送出。
4. 流量管理員會以最短時間找出託管設定檔中所定義端點的資料中心。 在此範例中會是 CS-B。
5. 流量管理員會將 CS-B 的網域名稱傳回給客戶端的本機 DNS 伺服器，此 DNS 伺服器會將網域名稱解析成 IP 位址並傳送給用戶端。
6. 用戶端會起始流量進入 CS-B。

**注意事項：**

- 如果您的設定檔包含相同資料中心內的多個端點，則導向至該資料中心的流量會平均分配到各個可用且根據端點監視狀況良好的端點。
- 如果給定資料中心內的所有端點無法使用 (根據端點監視)，這些端點的流量則會分配到設定檔中指定的所有其他可用端點，而不是下一個最靠近的端點。 如果下一個最靠近的端點超載，這可協助避免可能發生的連鎖失敗。
- 更新網際網路延遲資料表時，您可能會注意到流量模式及端點負載的差異。 這些變更應該很小。
- 使用效能流量路由方法與外部端點時，您必須指定這些端點的位置。 選擇最接近部署的 Azure 區域。 如需詳細資訊，請參閱 [流量管理員中管理端點](traffic-manager-endpoints.md)。

## 流量管理員圖形

如果您想要在本主題中的數字 PowerPoint 投影流量管理員的相關或您自己的用途修改您的簡報，請參閱 [MSDN 文件中的流量管理員圖形](http://gallery.technet.microsoft.com/Traffic-Manager-figures-in-887e7c99)。

## 後續步驟

[什麼是流量管理員？](traffic-manager-overview.md)

[關於流量管理員監視](traffic-manager-monitoring.md)

[流量管理員的相關作業 (REST API 參考)](http://go.microsoft.com/fwlink/p/?LinkID=313584)

[雲端服務](http://go.microsoft.com/fwlink/p/?LinkId=314074)

[網站](http://go.microsoft.com/fwlink/p/?LinkId=393327)

[Azure 流量管理員 Cmdlet](http://go.microsoft.com/fwlink/p/?LinkId=400769)

 
