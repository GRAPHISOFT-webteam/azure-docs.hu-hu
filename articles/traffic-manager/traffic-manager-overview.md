<properties 
   pageTitle="什麼是流量管理員 | Microsoft Azure"
   description="本文將協助您了解何謂流量管理員及其運作方式"
   services="traffic-manager"
   documentationCenter=""
   authors="joaoma"
   manager="carmonm"
   editor="tysonn" />
<tags 
   ms.service="traffic-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="12/07/2015"
   ms.author="joaoma" />

# 什麼是流量管理員？

Microsoft Azure 流量管理員可讓您控制使用者流量，將流量分散到指定的端點，端點可以包括 Azure 雲端服務、網站和其他端點。 流量管理員的運作方式是在您的網際網路資源網域名稱的網域名稱系統 (DNS) 查詢上套用情報原則引擎。 您的 Azure 雲端服務或網站可以在世界各地不同的資料中心間執行。

流量管理員可協助您：

- **提高重要應用程式的可用性** – 流量管理員可讓您監視 Azure 中的端點，並提供自動容錯移轉功能，Azure 雲端服務、 Azure 網站時，提高重要應用程式的可用性或其他位置停止。
- **改善高度執行應用程式的回應能力** – Azure 可讓您在位於世界各地的資料中心執行雲端服務或網站。 流量管理員可以藉由將使用者導向用戶端網路延遲最低的端點，改善應用程式的回應性和內容傳遞時間。
- **升級和執行服務維護，而不需要停機** – 流量管理員支援擴充的案例包括 「 高載至雲端，""移轉至雲端，「 混合式雲端和內部部署和 「 容錯移轉至雲端 」 案例。 如果是計畫性的維護，您可以在流量管理員中停用端點，然後等待端點完成現有的連線服務。 等端點沒有任何流量時，您就可以更新該端點上的服務並進行測試，然後在流量管理員中重新啟用端點。 如此一來將有助於在用戶端不停機的狀況下維護和升級您的服務。
- **大型、 複雜部署的流量分配** – 您可以使用巢狀的流量管理員設定檔，流量管理員設定檔可以有另一個流量管理員設定檔，做為端點，建立最佳化效能和分散的大型且複雜的部署組態。 如需詳細資訊，請參閱 [巢狀設定檔](#nested-profiles)。

## 流量管理員的運作方式

當您設定流量管理員設定檔時，您指定的設定會提供流量管理員所需的資訊，判斷哪一個端點應根據 DNS 查詢來服務要求。 流量管理員並不負責路由任何實際的端點流量。

*[圖 1* 顯示流量管理員將一組端點的其中一個使用者的導向。 圖 1 中的號碼對應至下列編號說明：

![流量管理員的運作方式](./media/traffic-manager-overview/IC740854.jpg)

**圖 1**

1. **流向公司網域名稱的使用者流量**︰ 用戶端要求使用公司網域名稱資訊。 目標是要將 DNS 名稱解析為 IP 位址。 公司網域必須透過標準網際網路網域名稱註冊保留，在流量管理員外部維護。 圖 1] 中的範例公司網域是 *www.contoso.com*。
2. **公司網域名稱指向流量管理員網域名稱**︰ 公司網域指向 Azure Traffic Manager 中維護的流量管理員網域名稱的 DNS 資源記錄。 方式是使用 CNAME 資源記錄，將公司網域名稱對應至流量管理員網域名稱。 在此範例中，流量管理員網域名稱是 *contoso.trafficmanager.net*。
3. **流量管理員網域名稱和設定檔**︰ 流量管理員網域名稱是流量管理員設定檔的一部分。 使用者的 DNS 伺服器會傳送新的 DNS 查詢流量管理員網域名稱 (在本例中， *contoso.trafficmanager.net*)，這接收的流量管理員 DNS 名稱伺服器。
4. **流量管理員設定檔的規則處理**︰ 流量管理員會使用指定的流量路由方法和監視狀態來判斷哪一個 Azure 或其他端點應該回應服務要求。
5. **端點網域名稱傳送給使用者**︰ 流量管理員傳回的 CNAME 記錄，對應的流量管理員網域名稱至端點網域名稱。 使用者的 DNS 伺服器將端點網域名稱解析為其 IP 位址，並將它傳送給使用者。
6. **使用者呼叫端點**︰ 使用者呼叫傳回直接使用其 IP 位址的端點。

由於用戶端電腦會快取公司網域和解析的 IP 位址，使用者會繼續與所選的端點互動，直到其本機 DNS 快取項目到期為止。 請務必注意，DNS 用戶端會快取 DNS 主機項目，持續時間為其存留時間 (TTL)。 從 DNS 用戶端快取擷取主機項目時會略過流量管理員設定檔，因此如果端點在 TTL 到期前變得無法使用，您可能會遇到連線延遲。 如果快取中 DNS 主機項目的 TTL 到期，且用戶端電腦必須再次解析公司網域名稱，它就會傳送新的 DNS 查詢。 用戶端電腦在要求時根據套用的流量路由方法和端點的健康情況，可能會收到不同端點的 IP 位址。

## 如何實作流量管理員

*[圖 2* 順序所需實作流量管理員中顯示的步驟。 當您確實了解流量管理員的組態和最佳作法之後，可以採用稍微不同的順序執行這些步驟。 圖 2 中的號碼對應至下列編號說明：

![如何設定流量管理員](./media/traffic-manager-overview/IC740855.jpg)

**圖 2**

1. **將 Azure 雲端服務、 網站、 或其他端點部署到實際執行環境**。 當您建立流量管理員設定檔時，必須與訂用帳戶關聯。 然後，您要將雲端服務和標準層網站的端點加入屬於相同訂用帳戶的生產環境。 如果端點處於預備環境而不是 Azure 生產環境，或不在相同的訂用帳戶中，則可以新增為外部端點。 如需雲端服務的詳細資訊，請參閱 [雲端服務](http://go.microsoft.com/fwlink/p/?LinkId=314074)。 如需網站的詳細資訊，請參閱 [網站](http://go.microsoft.com/fwlink/p/?LinkId=393327)。
2. **決定您的流量管理員網域名稱**。 請為您的網域名稱考慮使用唯一的前置詞。 網域的後半部 trafficmanager.net 是固定的。 如需詳細資訊，請參閱 [最佳作法](#best-practices)。
3. **決定您想要使用的監視組態**。 流量管理員會監視端點，確定它們處於線上狀態，無論流量路由方法為何。 設定監視設定後，流量管理員根據監視系統不會將流量導向離線的端點，除非它偵測到所有端點都是離線，或者無法偵測到設定檔中任何端點的狀態。 如需有關監視的詳細資訊，請參閱 [流量管理員監視](traffic-manager-monitoring.md)。
4. **決定您想要使用的流量路由方法**。 有三種不同的流量路由方法可以使用。 請花一些時間了解哪一種方法最能符合您的需求。 如果您稍後需要變更方法，可以隨時進行。 此外也請注意，每個方法需要的組態步驟稍有不同。 流量路由方法的相關資訊，請參閱 [關於流量管理員流量路由方法](traffic-manager-load-balancing-methods.md)。
5. **建立您的設定檔和組態設定**。 您可以使用 REST API、Windows PowerShell 或 Azure 傳統入口網站來建立流量管理員設定檔和進行設定。 如需詳細資訊，請參閱 [如何設定流量管理員設定](#how-to-configure-traffic-manager-settings)。 下列步驟假設您將使用 **快速建立** Azure 傳統入口網站中。 
   - **建立流量管理員設定檔** -若要使用 [快速建立在 Azure 傳統入口網站中建立設定檔，請參閱 [管理流量管理員設定檔](traffic-manager-manage-profiles.md)。
   - **設定流量路由方法設定** – 在快速建立 」，您必須為您的設定檔選取流量路由方法。 此設定可以在完成「快速建立」步驟之後隨時變更。 如需組態步驟，請參閱主題對應至您的流量路由方法 ︰ [設定效能流量路由方法](traffic-manager-configure-performance-load-balancing.md), ，[設定容錯移轉流量路由方法](traffic-manager-configure-failover-load-balancing.md), ，[設定循環配置資源流量路由方法](traffic-manager-configure-round-robin-load-balancing.md)。
   
   >[AZURE.NOTE] 流量路由方法的循環配置資源方法現在支援網路流量的加權的分配。 不過，您目前必須使用 REST API 或 Windows PowerShell 才能設定權數。 如需詳細資訊和範例組態，請參閱 [Azure 流量管理員外部端點和透過 PowerShell 的加權循環](http://azure.microsoft.com/blog/2014/06/26/azure-traffic-manager-external-endpoints-and-weighted-round-robin-via-powershell/) Azure 部落格中。

   - **設定端點** – 不會在 [快速建立 」 期間設定端點。 建立設定檔並指定流量路由方法之後，接著您必須讓流量管理員知道端點。 如需設定端點的步驟，請參閱 [流量管理員中管理端點](traffic-manager-endpoints.md)

   - **設定監視設定** – 監視設定不會在 [快速建立 」 期間設定。 建立設定檔並指定流量路由方法之後，接著您必須讓流量管理員知道要監視的對象。 若要設定監視的步驟，請參閱 [流量管理員監視](traffic-manager-monitoring.md)。
6. **測試流量管理員設定檔**。 測試您的設定檔和網域是否都按照預期方式運作。 如需如何執行這項操作，請參閱 [測試流量管理員設定](traffic-manager-testing-settings.md)。
7. **將公司網域名稱的 DNS 資源記錄指向設定檔使其 live**。 如需詳細資訊，請參閱 [將公司網際網路網域指向流量管理員網域](traffic-manager-point-internet-domain.md)。

使用圖 1 中的範例，您可以依照下列方式在您的伺服器上變更 DNS 資源記錄，將公司網域名稱指向流量管理員網域名稱：
    www.contoso.com IN CNAME contoso.trafficmanager.net

## 如何進行流量管理員設定

您可以使用 Azure 傳統入口網站，搭配REST API 和 Windows PowerShell Cmdlet 進行流量管理員設定。

雖然在 Azure 傳統入口網站中並不會顯示各個 REST API 項目，不過使用任一種方法都可以進行許多設定。 如需有關使用 REST api，請參閱 [流量管理員的相關作業 （REST API 參考）](http://go.microsoft.com/fwlink/p/?LinkId=313584)。

如需有關 Windows PowerShell 指令程式的流量管理員，請參閱 [Azure 流量管理員 Cmdlet](http://go.microsoft.com/fwlink/p/?LinkId=400769)。

>[AZURE.NOTE] 目前不支援設定外部端點 (類型 = 'Any')，循環配置資源加權流量路由方法，並使用 Azure 傳統入口網站的巢狀設定檔。 您必須使用 REST (請參閱 [建立定義](http://go.microsoft.com/fwlink/p/?LinkId=400772)) 或 Windows PowerShell (請參閱 [Add-azuretrafficmanagerendpoint](https://msdn.microsoft.com/library/azure/dn690257.aspx))。

### 在 Azure 傳統入口網站中進行設定

在 Azure 傳統入口網站中，您可以使用「快速建立」功能來建立流量管理員設定檔。 「快速建立」可讓您建立基本的設定檔。 建立設定檔之後，您可以再進行其他設定或編輯您先前進行的設定。 如需有關如何建立使用 [快速建立流量管理員設定檔的詳細資訊，請參閱 [管理流量管理員設定檔](traffic-manager-manage-profiles.md)。

您可以在 Azure 傳統入口網站中進行下列設定：

- **DNS 前置詞** – 您建立的唯一前置詞。 設定檔在 Azure 傳統入口網站中會以前置詞顯示。
- **DNS TTL** – DNS--存留時間 (TTL) 值控制用戶端的本機快取名稱伺服器查詢 Azure 流量管理員 DNS 系統更新 DNS 項目的頻率。
- **訂閱** – 選取您的設定檔將會對應到的訂閱。 請注意，只有當您有多個訂用帳戶時，才會出現這個選項。
- **流量路由方法** – 您想要流量管理員處理流量路由方式。
- **容錯移轉順序** – 當使用容錯移轉流量路由方法中，端點的順序。
- **監視** – 監視設定包含通訊協定 （HTTP 或 HTTPS）、 連接埠和相對路徑和檔案名稱。

### 使用 REST API 進行設定

您可以使用 REST API 來建立和設定您的流量管理員設定檔。 如需詳細資訊，請參閱 [流量管理員的相關作業 （REST API 參考）](http://go.microsoft.com/fwlink/?LinkId=313584)。

- **設定檔** – 設定檔包含您所建立的網域名稱前置詞。 每個設定檔都對應至您的訂用帳戶。 每個訂用帳戶可以建立多個設定檔。 設定檔名稱會顯示在 Azure 傳統入口網站中。 您在設定檔中建立的名稱，稱為「流量管理員網域」。
- **定義** – 定義包含原則設定和監視設定。 定義對應至設定檔。 每個設定檔可以只有一個定義。 雖然定義內的許多設定會顯示在 Azure 傳統入口網站中，而且可加以設定，但是定義本身並不會顯示在 Azure 傳統入口網站中。
- **DNS 選項** – 每個定義內都有 DNS 選項。 這是設定 DNS TTL 的位置。
- **監視** – 每個定義內都有監視設定。 這是設定通訊協定、連接埠以及相對路徑和檔案名稱的位置。 監視設定會顯示在 Azure 傳統入口網站中，而且可加以設定。 如需詳細資訊，請參閱 [流量管理員監視](traffic-manager-monitoring.md)。
- **原則** – 每個定義內都有原則設定。 原則是指定流量路由方法和端點之處。 雖然原則的某些設定會顯示在 Azure 傳統入口網站中，而且可加以設定，但是原則本身並不會顯示在 Azure 傳統入口網站中。 如需詳細資訊，請參閱 [關於流量管理員流量路由方法](traffic-manager-load-balancing-methods.md)。

## 使用 Windows PowerShell 進行設定

您可以使用 Windows PowerShell 來建立和設定您的流量管理員設定檔。 如需詳細資訊，請參閱 [Azure 流量管理員 Cmdlet](http://go.microsoft.com/fwlink/p/?LinkId=400769)。

## 最佳作法

- **讓您的前置詞獨一無二且容易了解** – 流量管理員設定檔的 DNS 名稱必須是唯一。 您只能控制 DNS 名稱的第一個部分。 流量管理員網域名稱僅用來識別並進行用戶端要求導向。 用戶端電腦一律不會對使用者顯示這些名稱。 不過，由於設定檔是按照此網域名稱識別，因此能夠與 Azure 傳統入口網站中列出的其他網域名稱快速區分很重要。
- **使用點增加唯一性或讓網域名稱具有可讀性** – 您可以使用句號分隔網域名稱前置詞以及組件。  如果您打算在流量管理員中建立多個原則，請使用一致的階層區分不同的服務。 例如，Contoso 有 Web、計費及公用程式管理等全球服務。 這三個原則會是 *web.contoso.trafficmanager.net*, ，*bill.contoso.trafficmanager.net*, ，和 *util.contoso.trafficmanager.net*。 設定雲端服務或網站時，請使用包含位置的名稱。 例如， *web web-us-contoso.cloudapp.net* 和 *web web-asia-contoso.cloudapp.net*。 您將受到 DNS 的規定限制。 假設網域名稱是以點分隔的標籤序列 (label.label.label.label.etc.)。 在準備這份文件時，流量管理員中的網域名稱限制如下：
   - 每個標籤最多可以有 63 個字元。
   - 最多不能超過 40 個標籤。 由於 trafficmanager.net 已佔用兩個標籤，所以就只剩下 38 個可做為前置詞。
   - 整個網域名稱最多可以有 253 個字元。 請記住，trafficmanager.net 已佔用了 19 個字元。
- **DNS TTL** – DNS TTL 值控制用戶端的本機快取名稱伺服器查詢 Azure 流量管理員 DNS 系統更新 DNS 項目的頻率。 流量管理員內的所有變更 (例如設定檔變更或端點可用性的變更)，都要等到這段時間之後，才會經由 DNS 伺服器的全球系統重新整理。 我們建議您保留 300 秒 (5 分鐘) 的預設值。 提高數值會增加 DNS 解析程式和用戶端快取流量管理員 DNS 回應的時間，減少整體的 DNS 查詢延遲。 不過，如果需要非常快速的容錯移轉，您可能想要設定較低的值。
- **端點應該位於單一訂閱** – 所有端點都應該都位於相同的訂閱建立設定檔中。 您可以將不同訂用帳戶的端點加入設定檔做為外部端點，但是如果停用或刪除相關聯的服務，Azure 不會自動移除這些端點。 如此一來，外部端點會保留在流量管理員設定檔中，除非您手動加以移除，否則您將繼續支付費用。
- **僅限生產服務** – 只有生產環境中的端點才能使用。 您無法導向在預備環境中執行的端點。 請注意，如果您在設定檔導向流量時執行虛擬 IP (VIP) 位址交換，流量將會使用剛交換至生產環境的端點。
- **名稱的端點，因此可以輕鬆地識別** – 請考量您想要使用的 DNS 首碼。 之所以使用 DNS 名稱，是因為它在訂用帳戶中保證是唯一的，但是雲端服務或網站的名稱則未必。 為了避免混淆，請為雲端服務或網站指定和 DNS 前置詞相同或類似的名稱。 如果您有超過 20 個雲端服務和網站，不當的命名可能會讓人難以找到正確的端點。 此外，端點命名不當會使得設定檔難以維護。
- **設定檔中的所有端點都應該都服務相同的作業和連接埠** – 如果您混用端點，會變得很可能在用戶端會呼叫無法都服務其要求的端點。
- **設定檔中的所有雲端服務必須都使用相同的監視設定** – 您只能選擇單一路徑和檔案，以監視指定定義中的所有端點。 您可以輸入"/"在 **相對路徑和檔案名稱** ] 文字方塊，使該監視將會嘗試存取預設路徑和檔案名稱。
- **停用端點暫時的變更，而非變更組態** – 在許多情況下，您可能想要讓端點離線。 您只要在設定檔中停用個別端點，不需要從設定檔移除端點。 這樣會在設定檔中保留端點，但是設定檔的運作結果會像是端點並未包含在其中一般。 這個動作對於暫時移除處於維護模式或重新部署的端點而言非常有用。 該端點一旦恢復並再次執行，就可以加以啟用。 如需詳細資訊，請參閱 [流量管理員中管理端點](traffic-manager-endpoints.md)。
- **停用暫時的變更，而不是刪除它的設定檔** – 您可能想要讓整個設定檔不只是個別端點離線當中指定。 若要執行，請停用設定檔。 當您停用設定檔時，您仍然可以在 Azure 傳統入口網站中編輯所有設定，當您想要再次使用時，可以快速而輕鬆讓設定檔恢復連接。 如需詳細資訊，請參閱 [流量管理員中管理端點](traffic-manager-endpoints.md)。
- **儲存體** – 如何設計位置和發佈您的存放裝置使用流量管理員時，是很重要的考量。 當您設計和部署流量管理員的應用程式時，請思考端對端交易以及您的資料要如何流動。
- **SQL Azure** -類似儲存體設計，分析當您延伸到多個地理區域端點的應用程式的狀態和資料需求。

## 巢狀設定檔

您可以指定另一個流量管理員設定檔的名稱做為端點，這種作法稱為「巢狀設定檔」。 流量管理員設定檔名稱是其 DNS 名稱，例如 contoso-europe.trafficmanager.net。

這可讓您設定流量管理員，以在一組層次中分析傳入 DNS 名稱查詢，以確保要求用戶端會被導向到一組正確的端點。 *[圖 3* 顯示範例。

![巢狀流量管理員設定檔的範例](./media/traffic-manager-overview/IC751072.png)

**圖 3**

您最多可以建立 10 個巢狀層級，每個設定檔都可以設定不同的流量路由方法。

例如，您可以建立下列組態：

- 在最上層 (對應到外部 DNS 名稱的流量管理員設定檔)，您可以設定具有效能流量路由方法的設定檔。
- 在中間層，一組流量管理員設定檔代表不同的資料中心，並使用循環配置資源流量路由方法。
- 在最底層，每個資料中心中的一組雲端服務端點服務使用者的流量要求。

結果，根據效能，使用者會被導向地理位置最適當的資料中心，然後根據相等或加權過的負載分散，使用者會被導向該資料中心內的雲端服務。 例如，您可以使用加權來分散一小部份的流量到新部署或試用部署，以便進行測試或收集客戶意見反應。

*[圖 4* 顯示設定。

![多層流量管理員設定檔的範例](./media/traffic-manager-overview/IC751073.png)

**圖 4**

在 *[圖 4*, 、 最上層的流量管理員設定檔是父設定檔和中介層的流量管理員設定檔是子項設定檔。

如果流量管理員將使用者導向只有少數端點狀況良好的子設定檔，可能會讓這些端點形成多載而造成效能問題。 若要避免這種狀況，您可以設定具有健康端點臨界值的父流量管理員設定檔，判斷該父設定檔的子設定檔中任何端點是否可以接收流量。 例如，如果您想要確保子設定檔中至少有三個狀況良好的端點，您就設定此臨界值為 3。 在圖 4 的範例中，您可以針對此臨界值設定最上層的流量管理員設定檔。

若要將流量管理員設定檔新增為端點狀況良好端點的最小數目，您必須使用 REST (請參閱 [建立定義](http://go.microsoft.com/fwlink/p/?LinkId=400772)) 或 Windows PowerShell (請參閱 [Add-azuretrafficmanagerendpoint](https://msdn.microsoft.com/library/azure/dn690257.aspx))。 您無法使用 Azure 傳統入口網站。

## 流量管理員圖形

如果您想要在本主題中的數字 PowerPoint 投影流量管理員的相關或您自己的用途修改您的簡報，請參閱 [MSDN 文件中的流量管理員圖形](http://gallery.technet.microsoft.com/Traffic-Manager-figures-in-887e7c99)。

## 後續步驟

[流量管理員路由方法](traffic-manager-routing-methods.md)

[流量管理員監視](traffic-manager-monitoring.md)

[建立設定檔](traffic-manager-manage-profiles.md)

[Azure 流量管理員 Cmdlet](http://go.microsoft.com/fwlink/p/?LinkId=400769) 

