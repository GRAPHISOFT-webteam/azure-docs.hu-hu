<properties 
    pageTitle="自動調整和 App Service 環境" 
    description="自動調整和 App Service 環境" 
    services="app-service"
    documentationCenter=""
    authors="btardif" 
    manager="wpickett" 
    editor="" 
/>

<tags 
    ms.service="app-service" 
    ms.workload="web" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="10/09/2015" 
    ms.author="byvinyal"
/>


# 自動調整和 App Service 環境

## 簡介

**App Service 環境**支援自動調整。 這被藉由可讓您將自動調整個別 
根據度量或排程的背景工作集區。

![][intro]

自動調整可讓您最佳化資源使用量來自動放大或縮小 
**App Service 環境** 符合您的預算，或載入設定檔。

## 設定背景工作集區自動調整

您可以從 [背景工作集區]**** 的 [設定] 索引標籤存取自動調整功能。

![][settings-scale]

從該處介面應相當熟悉，因為這是一樣的體驗時調整 
**應用程式服務方案**。 您將可以手動輸入調整值

![][scale-manual]

或設定自動調整設定檔：

![][scale-profile]

自動調整設定檔對於設定您的規模的限制很實用。 如此一來，您可以使用這兩個持續 
效能體驗，以設定下限縮放值 (1) 和可預測的 spend 端點 
設定上限 (2)。

![][scale-profile2]

一旦定義設定檔之後，可以加入度量型自動調整規則來向上或向下調整 
在執行個體數目的 **背景工作集區** 和設定檔所定義的範圍內。

![][scale-rule]

 任一個**背景工作集區**或**前端**度量可以用來定義自動調整規則。 這是 
 相同的度量您可以監視資源刀鋒視窗中的圖形來表示，或設定的警示。

## 自動調整範例

**App Service 環境**的自動調整可使用逐步解說一個案例來加以說明。 
在本文中我將引導完成所有必要的考量設定自動調整時， 
當我們在自動調整的因素，發揮效用的所有互動 **App Service 環境** ， 
裝載於 ASE。

### 案例簡介

Frank 是企業系統管理員，他已移轉至負責的工作負載的一部分 
**App Service 環境**。

**App Service 環境** 設定為手動的小數位數，如下所示:
* 前端: 3
* 背景工作集區 1: 10
* 背景工作集區 2: 5
* 背景工作集區 3: 5

**背景工作集區 1** 是用於生產工作負載，而 **背景工作集區 2** 和 **背景工作集區 3** 
用於品管及開發工作負載。

**應用程式服務計劃** 用 QA 和開發人員設定為 **手動調整** ，但實際執行 
**應用程式服務方案** 設為 **自動調整** 處理負載和流量變化。

Frank 是非常熟悉應用程式，他知道負載尖峰時段是之間 
上午 9:00 和下午 6:00: 這是因為 **LOB 應用程式** 而且中時，會由員工 
辦公室。 之後使用量會下降，就是在使用者下班時。 但仍有一些負載 
因為使用者可從遠端使用存取其行動裝置 」 或 「 家用電腦。 實際執行 
**應用程式服務方案** 已設定成 **自動調整** 以下列的 CPU 使用量 
規則:

![][asp-scale]

| **自動調整設定檔 - 工作日 - App Service 方案**| **自動調整設定檔 - 週末 - App Service 方案**|
|   ----------------------------------------------------    |   ----------------------------------------------------    |
| **名稱：**工作日設定檔| **名稱：**週末設定檔|
| **調整規模：**排程和效能規則| **調整規模：**排程和效能規則|
| **設定檔：**工作日| **設定檔：**週末|
| **類型：**循環| **類型：**循環|
| **目標範圍：**5 到 20 個執行個體| **目標範圍：**3 到 10 個執行個體|
| **星期幾：**星期一、星期二、星期三、星期四、星期五| **星期幾：**星期六、星期日|
| **開始時間：**上午 9:00| **開始時間：**上午 9:00|
| **時區：**UTC - 08| **時區：**UTC - 08|
| | |
| **自動調整規則 (相應增加)**| **自動調整規則 (相應增加)**|
| **資源：**生產環境 (App Service 環境)| **資源：**生產環境 (App Service 環境)|
| **度量：**CPU %| **度量：**CPU %|
| **作業：**大於 60%| **作業：**大於 80%|
| **持續時間：**5 分鐘| **持續時間：**10 分鐘|
| **時間彙總：**平均| **時間彙總：**平均|
| **動作：**計數增加 2| **動作：**計數增加 1|
| **冷卻時間 (分鐘)：**15| **冷卻時間 (分鐘)：**20|
| | |
| **自動調整規則 (相應減少)**| **自動調整規則 (相應減少)**|
| **資源：**生產環境 (App Service 環境)| **資源：**生產環境 (App Service 環境)|
| **度量：**CPU %| **度量：**CPU %|
| **作業：**少於 30%| **作業：**少於 20%|
| **持續時間：**10 分鐘| **持續時間：**15 分鐘|
| **時間彙總：**平均| **時間彙總：**平均|
| **動作：**計數減少 1| **動作：**計數減少 1|
| **冷卻時間 (分鐘)：**20| **冷卻時間 (分鐘)：**10|

### App Service 方案擴大率

設定為自動調整的 **App Service 方案**，就會以每小時最大的速率進行。 此速率 
可以計算根據提供的自動調整規則的值。

了解及計算 **應用程式服務方案擴大速率** ，請務必 
**App Service 環境** **背景工作集區** 小數位數後自動調整大小變更為 **背景工作集區** 是 
不是瞬間完成，執行需要一些時間才能套用。

**App Service 方案**擴大率的計算方式如下：

![][asp-inflation]

根據 *自動調整-向上延展* 規則 *工作日* 實際執行的設定檔 
**應用程式服務方案** 這看起來如下:

![][equation1]

如果是 *自動調整 – 向上延展* 規則 *週末* 實際執行的設定檔 
**應用程式服務方案** 公式會解析成:

![][equation2]

此值也可以針對相應減少作業計算：

根據 *自動調整位小數位數下* 規則 *工作日* 實際執行的設定檔 
**應用程式服務方案** 這看起來如下:

![][equation3]

如果是 *自動調整-小數位數下* 規則 *週末* 實際執行的設定檔 
**應用程式服務方案** 公式會解析成:

![][equation4]

這表示是生產 **應用程式服務方案** 所能成長的最大速率 **8** 
每小時一週中的執行個體和 **4** 每小時在週末期間的執行個體。 它可以和 
釋放執行個體的最大速率 **4** 每小時一週中的執行個體和 **6** 執行個體 
每小時在週末期間。

如果有多個 **應用程式服務計劃** 裝載於 **背景工作集區**, ，然後在 **總擴大率** 
計算的需求，而這可以是表示為 *總和* 所有的擴大率 
**應用程式服務計劃** 所裝載， **背景工作集區**。

![][asp-total-inflation]

### 使用 App Service 方案擴大率來定義背景工作集區自動調整規則

**背景工作集區** 該主機 **應用程式服務計劃** ，它會設定為需要自動調整大小 
要配置的容量，以允許自動調整大小作業，放大/縮小到緩衝區 
**應用程式服務方案** 視。 會計算最小緩衝區 
**總應用程式服務計劃擴大速率**。

由於 **App Service 環境** 調整規模作業需要一些時間才能套用，應該考量到任何變更 
更多小數位數時可能發生的需求變更作業正在進行中。 為此我們 
建議使用導出 **總應用程式服務計劃擴大率** 的最小數目為 
加入每個自動調整大小作業的執行個體。

使用此資訊，Frank 可以定義下列的自動調整設定檔和規則

![][worker-pool-scale]

| **自動調整設定檔 - 工作日**| **自動調整設定檔 - 週末**|
|   ----------------------------------------------------    |   --------------------------------------------    |
| **名稱：**工作日設定檔| **名稱：**週末設定檔|
| **調整規模：**排程和效能規則| **調整規模：**排程和效能規則|
| **設定檔：**工作日| **設定檔：**週末|
| **類型：**循環| **類型：**循環|
| **目標範圍：**13 到 25 個執行個體| **目標範圍：**6 到 15 個執行個體|
| **星期幾：**星期一、星期二、星期三、星期四、星期五| **星期幾：**星期六、星期日|
| **開始時間：**上午 7:00| **開始時間：**上午 9:00|
| **時區：**UTC - 08| **時區：**UTC - 08|
| | |
| **自動調整規則 (相應增加)**| **自動調整規則 (相應增加)**|
| **資源：**背景工作集區 1| **資源：**背景工作集區 1|
| **度量：**WorkersAvailable| **度量：**WorkersAvailable|
| **作業：**少於 8| **作業：**少於 3|
| **持續時間：**20 分鐘| **持續時間：**30 分鐘|
| **時間彙總：**平均| **時間彙總：**平均|
| **動作：**計數增加 8| **動作：**計數增加 3|
| **冷卻時間 (分鐘)：**90| **冷卻時間 (分鐘)：**90|
| | |
| **自動調整規則 (相應減少)**| **自動調整規則 (相應減少)**|
| **資源：**背景工作集區 1| **資源：**背景工作集區 1|
| **度量：**WorkersAvailable| **度量：**WorkersAvailable|
| **作業：**大於 8| **作業：**少於 3|
| **持續時間：**20 分鐘| **持續時間：**15 分鐘|
| **時間彙總：**平均| **時間彙總：**平均|
| **動作：**計數減少 2| **動作：**計數減少 3|
| **冷卻時間 (分鐘)：**90| **冷卻時間 (分鐘)：**90|

設定檔中定義的目標範圍的計算方式是定義中的最小執行個體 
設定檔， **應用程式服務方案** + 緩衝區。

最大值範圍是所有的最大範圍的總和 **應用程式服務計劃** 裝載於 
**背景工作集區**。

擴大規則的增加計數應該設定為至少是 1 X 
**應用程式服務計劃擴大速率** 進行擴充的候選。

減少計數可以調整為 1/2 X 或 1 X * * 應用程式服務計劃變大 
速率 * * 的向下調整。

### 前端集區的自動調整

**前端** 自動調整規模 」 規則會比簡單的 **背景工作集區**, ，是要尋找的主要事項 
請確定持續時間的度量和 cooldown 計時器 take 考量調整的事實 
作業 **應用程式服務方案** 不會在瞬間完成。

此案例中，Frank 知道錯誤率增加當前端達到 80%的 CPU 使用率 
若要避免這個他設定自動調整規則，以增加執行個體，如下所示:

![][front-end-scale]

| **自動調整設定檔 - 前端**|
|   --------------------------------------------    |
| **名稱：**自動調整 - 前端|
| **調整規模：**排程和效能規則|
| **設定檔：**每日|
| **類型：**循環|
| **目標範圍：**3 到 10 個執行個體|
| **星期幾：**每日|
| **開始時間：**上午 9:00|
| **時區：**UTC - 08|
| |
| **自動調整規則 (相應增加)**|
| **資源：**前端集區|
| **度量：**CPU %|
| **作業：**大於 60%|
| **持續時間：**20 分鐘|
| **時間彙總：**平均|
| **動作：**計數增加 3|
| **冷卻時間 (分鐘)：**90|
| |
| **自動調整規則 (相應減少)**|
| **資源：**背景工作集區 1|
| **度量：**CPU %|
| **作業：**少於 30%|
| **持續時間：**20 分鐘|
| **時間彙總：**平均|
| **動作：**計數減少 3|
| **冷卻時間 (分鐘)：**90|



[intro]: ./media/app-service-environment-auto-scale/introduction.png 
[settings-scale]: ./media/app-service-environment-auto-scale/settings-scale.png 
[scale-manual]: ./media/app-service-environment-auto-scale/scale-manual.png 
[scale-profile]: ./media/app-service-environment-auto-scale/scale-profile.png 
[scale-profile2]: ./media/app-service-environment-auto-scale/scale-profile-2.png 
[scale-rule]: ./media/app-service-environment-auto-scale/scale-rule.png 
[asp-scale]: ./media/app-service-environment-auto-scale/asp-scale.png 
[asp-inflation]: ./media/app-service-environment-auto-scale/asp-inflation-rate.png 
[equation1]: ./media/app-service-environment-auto-scale/equation1.png 
[equation2]: ./media/app-service-environment-auto-scale/equation2.png 
[equation3]: ./media/app-service-environment-auto-scale/equation3.png 
[equation4]: ./media/app-service-environment-auto-scale/equation4.png 
[asp-total-inflation]: ./media/app-service-environment-auto-scale/asp-total-inflation-rate.png 
[worker-pool-scale]: ./media/app-service-environment-auto-scale/wp-scale.png 
[front-end-scale]: ./media/app-service-environment-auto-scale/fe-scale.png 

