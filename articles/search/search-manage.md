<properties 
    pageTitle="在 Microsoft Azure 上管理您的搜尋服務 | Microsoft Azure | 雲端託管搜尋服務" 
    description="管理 Azure 搜尋服務 (Microsoft Azure 上之託管的雲端搜尋服務)" 
    services="search" 
    documentationCenter="" 
    authors="HeidiSteen" 
    manager="mblythe" 
    editor=""
    tags="azure-portal"/>

<tags 
    ms.service="search" 
    ms.devlang="rest-api" 
    ms.workload="search" 
    ms.topic="article" 
    ms.tgt_pltfrm="na" 
    ms.date="11/04/2015" 
    ms.author="heidist"/>

# 在 Microsoft Azure 上管理搜尋服務

Azure 搜尋服務是包含 HTTP 架構 API 的雲端型服務，可用於自訂搜尋應用程式中。 搜尋服務提供的引擎具備全文檢索文字分析、進階搜尋功能、搜尋資料儲存體及查詢命令語法。 

這篇文章說明如何管理搜尋服務中的 [Azure 傳統入口網站](https://portal.azure.com)。

或者，您可以使用管理 REST API。 請參閱 [開始使用 Azure 搜尋管理 REST API](search-get-started-management-api.md) 和 [Azure 搜尋管理 REST API 參考](http://msdn.microsoft.com/library/azure/dn832684.aspx) 如需詳細資訊。

<a id="sub-1"></a>
## 將搜尋服務加入您的訂用帳戶中

身為管理員的您在設定搜尋服務時，您的第一個決策之一就是選擇價格層。 選項包括免費和標準定價層級。

您可以選擇共用服務 (我們並不會向現有訂戶收費)，並建議您將其用於學習、概念證明測試，以及小型開發專案上。 共用服務的限制為 50 MB 儲存體、3 個索引及有限的文件份數 (無論佔用的儲存體是否少於完整的 50 MB，皆固定限制 10,000 份文件)。 共用服務並沒有效能保證，因此如果您要建置生產搜尋應用程式，可以考慮使用標準搜尋。

標準搜尋會因為您登入您訂用帳戶專屬的特定資源和架構，而收取費用。 標準搜尋會配置在使用者定義的大量資料分割 (儲存體) 及複本 (服務工作負載) 中，並以搜尋單元計費。 您可以藉由個別擴充資料分割或複本規模，來新增更多需要的資源。

若要規劃功能和了解計費標準，可參考下列連結：

+   [限制條件](search-limits-quotas-capacity.md)
+   [價格詳細資料](http://go.microsoft.com/fwlink/p/?LinkdID=509792)

當您準備要註冊，請參閱 [入口網站中建立搜尋服務](search-create-service-portal.md)。

<a id="sub-2"></a>
## 管理工作

雖然有些服務允許擁有共同管理員，但在 Azure 搜尋服務上，每個訂用帳戶只會有一個管理員。 您必須是系統管理員才能執行本節所述的工作。
除了新增訂閱的搜尋功能以外，系統管理員還負責處理這些額外工作：

+   服務發佈 URL (佈建服務時所定義的)。
+   管理和發佈 API 金鑰。
+   監視資源使用量
+   擴大或縮小規模 (僅適用於標準搜尋)
+   啟用或停止服務
+   設定角色以控制管理存取權

<a id="sub-3"></a>
## 服務 URL

當您建立服務時，會將服務 URL 定義為固定屬性，且之後無法變更。 

建置搜尋應用程式的開發人員必須知道用於 HTTP 要求的服務 URL。 您可以透過服務儀表板，快速找到服務 URL。

透過服務儀表板取得服務 URL：

1.  登入 [Azure 傳統入口網站](https://portal.azure.com)。
2.  按一下 [ **瀏覽** | **所有項目** | **搜尋服務**。
3.  按一下您的搜尋服務名稱以開啟儀表板。
4.  按一下 [ **屬性** 以滑動開啟屬性頁面。 服務 URL 位於頁面頂端。 您可以釘選此頁面，方便等一下快速存取。

    ![][8]

開發人員可能也會要求 API 版本。 Azure 搜尋 API 的程式碼編寫需求一律會在要求中指定 API 版本。 因為有此需求的存在，開發人員才可以持續使用先前的版本，並在適當時機轉移到較新的版本。

由於 API 版本並沒有顯示在入口網站頁面中，因此您無法提供這項資訊。 如需目前和舊版的 API 版本的詳細資訊，請參閱 [Azure 搜尋服務 REST API](http://go.microsoft.com/fwlink/p/?LinkdID=509922)。


<a id="sub-4"></a>
## 管理 API 金鑰

建置搜尋應用程式的開發人員需具備 API 金鑰以存取搜尋。 搜尋服務的每個 HTTP 要求，皆需要專為您的服務而產生的 API 金鑰。 此 API 金鑰是驗證您搜尋服務 URL 的唯一機制。

存取搜尋服務的金鑰有兩種類型：

+   管理員 (適用於任何作業)
+   查詢 (僅適用於查詢要求)

管理員 API 金鑰會與服務一起建立。 包括主要金鑰和次要金鑰。 您可以平均地使用這些金鑰；並沒有傳遞較高或較低階層存取的區分，這在您要更換金鑰的事件中十分實用。 您可以重新產生任何一種管理員金鑰，但您無法增加管理員金鑰的總數量。 每個搜尋服務最多可以有 2 個管理員金鑰。

查詢金鑰是專為直接呼叫搜尋的用戶端應用程式所設計。 您最多可以建立 50 個查詢金鑰。

若要取得或重新產生 API 金鑰，請開啟服務儀表板。 按一下 [ **金鑰** 以滑動開啟金鑰管理頁面。 重新產生或建立金鑰的命令位於頁面頂端。

 ![][9]


<a id="sub-5"></a>
## 監視資源使用量

在此公開預覽版本中，僅能針對服務儀表板中顯示的資訊，以及一些透過查詢服務取得的度量進行資源監視。

在服務儀表板上的使用量區段中，您可以快速判斷資料分割資源層級是否適合您的應用程式。

使用搜尋服務 API 可取得文件和索引的計數。 根據價格層不同，會有些與這些計數相關聯的固定限制。 請參閱 [限制和條件約束](search-limits-quotas-capacity.md) 如需詳細資訊。 

+   [取得索引統計資料](http://msdn.microsoft.com/library/dn798942.aspx)
+   [文件計數](http://msdn.microsoft.com/library/dn798924.aspx)

> [AZURE.NOTE] 快取行為可暫時放寬限制。 例如，使用共用服務時，您可能會看到文件計數超過固定限制的 10,000 份文件。 這種「超出限制」是暫時的，並且將會在下一次的限制強制檢核中偵測出來。 


<a id="sub-6"></a>
## 擴大或縮小規模

每個搜尋服務都會以一個複本和一個資料分割的最小值開始執行。 如果您登入專用的資源，使用標準價格層，您可以按一下 **延展** 磚重新調整資料分割和服務所使用的複本數目的服務儀表板。

當您加入任何資源時，服務即會自動使用這些資源。 您無須再執行其他動作，但在新資源產生作用前，將會有些許的延遲。 佈建其他資源需要 15 分鐘或更久的時間。

 ![][10]

### 新增複本

系統會藉由新增複本來增加每秒查詢 (QPS) 數量或達到高可用性。 每個複本都有一個索引的副本，因此再新增一個複本就會轉譯出可在服務查詢要求中使用的索引。 根據經驗看來，您目前至少需要 3 個複本才能達到高可用性。 

有許多複本的搜尋服務可透過大量索引來達到查詢要求的負載平衡。 假設有一定等級的查詢量，當有愈多服務要求可用的索引副本時，查詢輸送量的速度就會愈快。 如果您有查詢延遲的經驗，可以期待線上有其他複本時，對效能所造成的正面影響。

雖然當您新增複本時會提高輸送量，但並不會以您新增至服務之複本的正好兩倍或三倍來計算提高程度。 所有搜尋應用程式皆會因為影響查詢效能的外部因素而受影響。 複雜的查詢和網路延遲是造成查詢回應次數變化的兩個因素。

### 新增資料分割

比起資料分割，大多數的服務應用程式需要內建更多複本；因為大多數使用搜尋的應用程式都可以適用最多可支援 1,500 萬份文件的單一資料分割。 

對於需要新增文件計數的案例，您可以新增資料分割。 請注意，資料分割要以 12 的倍數新增 (準確來說是 1、2、3、4、6 或 12)。 這是分區化成品，索引會建立在 12 個分區中，並且可以全部儲存在 1 個資料分割中，或平均分配在 2、3、4、6 或 12 個資料分割中 (每個資料分割分配一個分區)。

### 移除複本

高查詢量期間過後，一旦搜尋的查詢負載量回到標準時 (例如，假日拍賣結束後)，您很有可能會將複本移除。

若要這麼做，您只需將複本滑動軸移回到較低數目即可。 無須再執行其他步驟。 降低複本數量會讓出資料中心內的虛擬機器。 相較於先前的情況，現在會在較少的 VM 上執行您的查詢和資料擷取作業。 最小的限制為一個複本。

### 移除資料分割

相較於您無須付出多餘動作就可移除複本，如果您使用的儲存體大於可減少的儲存體，您可能需要完成一些工作。 例如，如果您的解決方案使用 3 個資料分割，而您使用的儲存體比所減少資料分割數量可使用的儲存體多，那麼嘗試減少 1 個或 2 個資料分割時則會出現錯誤。 在這種情況下，您可以選擇刪除索引或相關索引內的文件來釋出空間，或保持目前設定。

沒有任何偵測方法可告訴您哪個索引分區儲存在哪個特定資料分割中。 每個資料分割提供大約 25 GB 的儲存體，因此您需要將儲存體減少至可讓您擁有的資料分割數量所能容納的大小。 如果您想還原成一個資料分割，所有 12 個分區皆要能符合。

若要協助進行未來規劃，您可能想要檢查儲存體 (使用 [取得索引統計資料](http://msdn.microsoft.com/library/dn798942.aspx)) 若要查看多少實際上您可以使用。 


<a id="sub-7"></a>
## 啟用或停止服務

您可以使用服務儀表板上的命令，來啟用、停止或甚至刪除服務。

 ![][11]


停止或啟用服務並不會取消計費。 您必須刪除服務以避免收費。 當您結束服務時，與您服務相關的所有資料也會刪除。

<a id="sub-8"></a>
## 設定管理存取權的角色

Azure 特別為透過入口網站管理的所有服務，或在 Azure 資源管理員 API 中 (如果您使用自訂系統管理工具)，提供全域角色型授權模型。 「擁有者」、「參與者」和「讀取者」角色可針對您指派給各角色的 Active Directory 使用者、群組和安全性主體，設定服務管理層級。 請參閱 [Azure 傳統入口網站中的角色型存取控制](../role-based-access-control-configure.md) 角色成員資格的詳細資料。

就 Azure Search 而言，角色存取控制可決定下列管理工作：


角色|工作
---|---
擁有者|啟動、停止或刪除服務。<p>產生並檢視管理金鑰和查詢金鑰。<p>檢視服務狀態，包括索引計數、索引名稱、文件計數和儲存體大小。<p>新增或刪除角色成員資格 (只有「擁有者」可以管理角色成員資格)。<p>訂閱和服務管理員自動具有「擁有者」角色的成員資格。
參與者|除了角色管理以外，具有與「擁有者」相同層級的存取權。 例如，參與者可以檢視和重新產生 `api-key`，但不能修改角色成員資格。
讀取者|檢視服務狀態及查詢金鑰。 這個角色的成員無法啟動或停止服務，也無法檢視管理金鑰。

請注意，角色不會授與服務端點的存取權限。 搜尋服務作業 (例如索引管理、索引母體擴展，以及搜尋資料查詢) 可透過 api-key 而非角色來控制。 請參閱中的 「 管理授權與資料作業 」 [Azure 傳統入口網站中的角色型存取控制](../role-based-access-control-configure.md) 如需詳細資訊。

建立服務之後，角色會提供存取控制。 只有訂閱管理員可以新增訂閱的搜尋服務。

<!--Anchors-->
[Add search service to your subscription]: #sub-1
[Administrative tasks]: #sub-2
[Service URL]: #sub-3
[Manage the api-keys]: #sub-4
[Monitor resource usage]: #sub-5
[Scale up or down]: #sub-6
[Start or Stop the Service]: #sub-7
[Set roles to control administrative access]: #sub-8

<!--Image references-->
[8]: ./media/search-manage/Azure-Search-Manage-1-URL.png
[9]: ./media/search-manage/Azure-Search-Manage-2-Keys.png
[10]: ./media/search-manage/Azure-Search-Manage-3-ScaleUp.png
[11]: ./media/search-manage/Azure-Search-Manage-4-StartStop.png


 

