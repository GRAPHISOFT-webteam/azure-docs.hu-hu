<properties
    pageTitle="疑難排解 VM 配置失敗 | Microsoft Azure"
    description="在 Azure 中建立、重新啟動或調整 VM 大小時，對配置失敗進行疑難排解"
    services="virtual-machines, azure-resource-manager"
    documentationCenter=""
    authors="jiangchen79"
    manager="felixwu"
    editor=""
    tags="top-support-issue"/>

<tags
    ms.service="virtual-machines"
    ms.workload="na"
    ms.tgt_pltfrm="ibiza"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/29/2015"
    ms.author="kenazk"/>




# 在 Azure 中建立、重新啟動或調整 VM 大小時，對配置失敗進行疑難排解

建立 VM、重新啟動已停止 (取消配置) 的 VM 和重新調整 VM 大小時，Microsoft Azure 會配置計算資源給您的訂用帳戶。 執行這些作業時，即使尚未達到 Azure 訂用帳戶限制，也可能偶爾發生錯誤。 本文說明一些常見配置失敗的原因，並建議可能的補救方法。 規劃服務的部署時，本資訊可能也很有用。

如果這篇文章中並未提及您的 Azure 問題，請造訪 [Azure 論壇 MSDN 和堆疊溢位上的](https://azure.microsoft.com/support/forums/)。 您可以在這些論壇上，或前往 Twitter 的 @AzureSupport 上張貼您的問題。 此外，您可以選取提出 Azure 支援要求 **取得支援** 上 [Azure 支援](http://azure.microsoft.com/support/options/) 站台。

＜針對常見的配置失敗進行疑難排解＞一節列出解決常見問題的步驟。 ＜針對特定的配置失敗案例進行疑難排解＞一節依特定的錯誤訊息提供解決步驟。 開始之前，以下是了解配置運作方式及配置失敗原因的一些背景資訊。

## 背景資訊

### 配置的運作方式

Azure 資料中心的伺服器分割成叢集。 通常會嘗試向多個叢集提出配置要求，但配置要求可能帶有某些條件約束，而強制 Azure 平台只嘗試向一個叢集提出要求。 在本文中，這種情況稱為「釘選到叢集」。 下面圖 1 說明嘗試在多個叢集; 中的一般配置的大小寫圖 2 說明配置的情況下，已釘選到 Cluster 2，因為這是裝載現有的雲端服務 CS_1 或可用性設定組。
![配置圖表](./media/virtual-machines-allocation-failure/Allocation1.png)

### 配置失敗的原因

當配置要求已釘選到叢集時，由於可用的資源集區較小，很可能找不到可用的資源。 此外，如果配置要求已釘選到叢集，但該叢集不支援您所要求的資源類型，即使叢集有可用的資源，您的要求仍會失敗。 下圖 3 說明由於唯一候選叢集沒有可用的資源，導致已釘選的配置失敗的情況。 圖 4 說明因唯一候選叢集不支援所要求的 VM 大小 (雖然叢集有可用的資源)，而導致已釘選的配置失敗的情況。

![釘選配置失敗](./media/virtual-machines-allocation-failure/Allocation2.png)

## 一般疑難排解步驟

### 疑難排解傳統部署模型中常見的配置失敗

這些步驟可協助解決虛擬機器中的許多配置失敗。

- VM 調整為不同的 VM 大小。<br>
    按一下 [全部瀏覽] > [虛擬機器 (傳統)] > [您的虛擬機器] > [設定] > [大小]****。 如需詳細步驟，請參閱 [調整虛擬機器的大小](https://msdn.microsoft.com/library/dn168976.aspx)。

- 刪除雲端服務中的所有 Vm，並重新建立 Vm。<br>
    按一下 [全部瀏覽] > [虛擬機器 (傳統)] > [您的虛擬機器] > [刪除]。 然後，按一下 [新增] > [計算] > [虛擬機器映像]

### 疑難排解資源管理員部署模型中常見的配置失敗

這些步驟可協助解決虛擬機器中的許多配置失敗。

- 停止解除配置相同可用性設定組中的所有 Vm，然後重新啟動每一個。<br>
    若要停止: 按一下 [資源群組 > 資源群組 > 資源 > 您的可用性設定組 > 虛擬機器 > 您的虛擬機器。 > 停止

    所有 VM 都停止後，選取第一個 VM 並按一下 [啟動]。

## 詳細的疑難排解步驟

### 疑難排解傳統部署模型中特定的配置失敗情況

以下是造成釘選配置要求的常見配置案例。 我們將在本文稍後深入探討每一個案例。

- 調整 VM 大小或將其他 VM 或角色執行個體加入至現有的雲端服務
- 重新啟動已停止 (取消配置) 的 VM - 部分取消配置
- 重新啟動已停止 (取消配置) 的 VM - 完整取消配置
- 預備/生產部署 (僅適用於平台即服務)
- 同質群組 - VM/服務鄰近性
- 同質群組式虛擬網路

發生配置錯誤時，請查看以下是否有任何案例符合您所處的情況。 使用 Azure 平台傳回的配置錯誤來識別對應的案例。 如果您的要求已釘選，請嘗試移除一些釘選條件約束，向更多叢集展現您的要求，以提高配置成功的機會。

一般而言，只要錯誤不是表示「不支援所要求的 VM 大小」，您永遠都可以稍後再重試，因為到時叢集可能釋放足夠的資源來滿足您的要求。 如果問題在於不支援所要求的 VM 大小，請嘗試不同的 VM 大小。否則，唯一的選擇就是移除釘選條件約束。

有兩個常見的失敗案例與同質群組有關。 在過去，同質群組是為了支援 VM/服務執行個體的鄰近性，或用於支援建立虛擬網路 (VNet)。 在引進區域虛擬網路之後，建立虛擬網路已不再需要同質群組。 由於 Azure 基礎結構中的網路延遲縮短，原本建議使用同質群組來支援 VM/服務鄰近性的情況已有所改變。

下的圖 5 顯示 (pin) 配置案例的分類。
![釘選配置分類](./media/virtual-machines-allocation-failure/Allocation3.png)
> [AZURE.NOTE] 每個配置案例中列出的錯誤是簡短格式。 請參閱 [附錄](#appendix) 詳細的錯誤字串。

#### 配置案例：調整 VM 大小，或將其他 VM 或角色執行個體加入現有的雲端服務

**錯誤**

Upgrade_VMSizeNotSupported* 或 GeneralError*

**叢集釘選的原因**

必須在託管現有雲端服務的原始叢集上，嘗試要求調整 VM 大小，或將 VM 或角色執行個體加入現有的雲端服務。 建立新的雲端服務可讓 Azure 平台尋找另一個有可用資源的叢集，或另一個支援您所要求的 VM 大小的叢集。

**因應措施**

如果錯誤是 Upgrade_VMSizeNotSupported*，請嘗試不同的 VM 大小。 如果使用不同的 VM 大小不可行，但可接受使用不同的虛擬 IP 位址 (VIP)，請建立新的雲端服務來裝載新的 VM，並將新的雲端服務加入至執行現有 VM 的區域虛擬網路。 如果您現有的雲端服務不會使用區域虛擬網路，您可以仍然為新的雲端服務中建立新的虛擬網路，然後再連線您 [存到新的 VNet 的 VNet](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/)。 查看更多 [區域虛擬網路](http://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/)。

如果錯誤為 GeneralError*，很可能是叢集雖然支援資源的類型 (例如特定的 VM 大小)，但叢集目前沒有可用的資源。 類似上述，透過建立新的雲端服務 (請注意，新的雲端服務必須使用不同的 VIP) 嘗試新增所需的計算資源，並使用區域虛擬網路連接您的雲端服務。

#### 配置案例：重新啟動已停止 (取消配置) 的 VM - 部分取消配置

**錯誤**

GeneralError*

**叢集釘選的原因**

**部分**解除配置表示您已停止 (解除配置) 雲端服務中的一或多部 VM，而**不是所有** VM。 停止 (取消配置) VM 時會釋放相關聯的資源。 因此，重新啟動已停止 (取消配置) 的 VM 是一項新的配置要求。 在部分取消配置的雲端服務中重新啟動 VM 時，等同於將 VM 加入現有的雲端服務，而且必須在託管現有雲端服務的原始叢集上，嘗試提出配置要求。 另外建立一個雲端服務可讓 Azure 平台尋找另一個有可用資源的叢集，或另一個支援您所要求之 VM 大小的叢集。

**因應措施**

如果可接受使用不同的 VIP，請刪除已停止 (取消配置) 的 VM (但保留相關聯的磁碟)，並透過不同的雲端服務重新加回 VM。 您可以使用區域虛擬網路連線您的雲端服務:
1.  如果現有的雲端服務使用區域虛擬網路，只要將新的雲端服務加入至相同的虛擬網路即可。
2.  如果您現有的雲端服務不會使用區域虛擬網路，建立新的雲端服務，新的虛擬網路，然後 [您現有的 VNet 連接到新的 VNet](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/)。 查看更多 [區域虛擬網路](http://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/)。

#### 配置案例：重新啟動已停止 (取消配置) 的 VM - 完整取消配置

**錯誤**

GeneralError*

**叢集釘選的原因**

**完整**解除配置表示您停止 (解除配置) 雲端服務上的**所有** VM。 目前為止，必須在裝載雲端服務的原始叢集上，嘗試提出配置要求來重新啟動這些 VM。 建立新的雲端服務可讓 Azure 平台尋找另一個有可用資源的叢集，或另一個支援您所要求的 VM 大小的叢集。

**因應措施**

如果可接受使用不同的 VIP，請刪除原始已停止 (取消配置) 的 VM (但保留相關聯的磁碟)，並刪除對應的雲端服務 (停止 (取消配置) VM 時，就已釋放相關聯的計算資源)。 建立新的雲端服務以加回 VM。

#### 配置案例：預備/生產環境部署 (僅適用於平台即服務)

**錯誤**

New_General* 或 New_VMSizeNotSupported*

**叢集釘選的原因**

雲端服務的預備環境部署和生產環境部署裝載於相同的叢集。 新增第二個部署時，將會在裝載第一個部署的相同叢集中嘗試提出對應的配置要求。

**因應措施**

如果可接受，請刪除第一個部署和原始的雲端服務，然後重新部署雲端服務。 這個動作可能將第一個部署安排到有足夠可用資源可滿足這兩個部署的叢集，或安排到支援所要求 VM 大小的叢集。

#### 配置案例：同質群組 - VM/服務鄰近性

**錯誤**

New_General* 或 New_VMSizeNotSupported*

**叢集釘選的原因**

任何指派給同質群組的計算資源都繫結至一個叢集。 該同質群組中新的計算資源要求，將於裝載現有資源的相同叢集中嘗試提出。 無論是透過新的雲端服務或現有的雲端服務建立新的資源，都是如此。

**因應措施**

如果沒有必要，請勿使用同質群組或嘗試將計算資源分組為多個同質群組。

#### 配置案例：同質群組式虛擬網路

**錯誤**

New_General* 或 New_VMSizeNotSupported*

**叢集釘選的原因**

在宣告區域虛擬網路之前，您必須先將虛擬網路與同質群組產生關聯。 如此一來，將會依上一節「配置案例：同質群組 - VM/服務鄰近性」所述的相同條件約束，繫結放入同質群組中的計算資源 - 計算資源會繫結至一個叢集。

**因應措施**

如果您不需要同質群組，建立新的資源，您要加入，新的區域虛擬網路，然後 [您現有的 VNet 連接到新的 VNet](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/)。 查看更多 [區域虛擬網路](http://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/)。

或者，您可以 [移轉至區域虛擬網路的同質群組為基礎的虛擬網路](http://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/), ，然後再試一次加入所需的資源。

### 疑難排解 Azure 資源管理員部署模型中特定的配置失敗案例

以下是造成釘選配置要求的常見配置案例。 我們將在本文稍後深入探討每一個案例。

- 調整 VM 大小或將其他 VM 或角色執行個體加入至現有的雲端服務
- 重新啟動已停止 (解除配置) 的 VM - **部分**解除配置
- 重新啟動已停止 (解除配置) 的 VM - **完整**解除配置

發生配置錯誤時，請查看以下是否有任何案例符合您所處的情況。 使用 Azure 平台傳回的配置錯誤來識別對應的案例。 如果您的要求已釘選到現有的叢集，請嘗試移除一些釘選條件約束，向更多叢集展現您的要求，以提高配置成功的機會。

一般而言，只要錯誤不是表示「不支援所要求的 VM 大小」，您永遠都可以稍後再重試，因為到時叢集可能釋放足夠的資源來滿足您的要求。 如果問題在於不支援所要求的 VM 大小，請參閱以下的因應措施。

#### 配置案例：調整 VM 大小，或將其他 VM 加入至現有的可用性設定組

**錯誤**

Upgrade_VMSizeNotSupported* 或 GeneralError*

**叢集釘選的原因**

必須在裝載現有可用性設定組的原始叢集上，嘗試要求調整 VM 大小，或將 VM 加入至現有的可用性設定組。 建立新的可用性設定組可讓 Azure 平台尋找另一個有可用資源的叢集，或另一個支援您所要求的 VM 大小的叢集。

**因應措施**

如果錯誤是 Upgrade_VMSizeNotSupported*，請嘗試不同的 VM 大小。 如果使用不同的 VM 大小不可行，請停止可用性設定組中的所有 VM。 這可讓您變更虛擬機器的大小，以便將 VM 配置到支援所需 VM 大小的叢集。

如果錯誤是 GeneralError*，很可能是叢集支援資源的類型 (例如特定的 VM 大小)，但叢集目前沒有可用的資源。 如果 VM 可以屬於不同的可用性設定組，請在不同的可用性設定組 (位於相同區域) 中建立新的 VM。 然後，這個新的 VM 就可以加入至相同的虛擬網路。

#### 配置案例：重新啟動已停止 (取消配置) 的 VM - 部分取消配置

**錯誤**

GeneralError*

**叢集釘選的原因**

**部分**解除配置表示您已停止 (解除配置) 可用性設定組中的一或多部 VM，而**不是所有** VM。 停止 (取消配置) VM 時會釋放相關聯的資源。 因此，重新啟動已停止 (取消配置) 的 VM 是一項新的配置要求。 在部分取消配置的可用性設定組中重新啟動 VM，等同於將 VM 加入現有的可用性設定組，而且必須在託管現有可用性設定組的原始叢集上，嘗試提出配置要求。

**因應措施**

先嘗試停止可用性設定組中的所有 VM，再重新啟動第一個 VM。 如此可確保執行新的配置嘗試，而且可以選取有容量可用的新叢集。

#### 配置案例：重新啟動已停止 (取消配置) 的 VM - 完整取消配置

**錯誤**

GeneralError*

**叢集釘選的原因**

**完整**解除配置表示您已停止 (解除配置) 可用性設定組中的**所有** VM。 提出配置要求來重新啟動這些 VM 時，將會以支援所需大小的所有叢集為目標。

**因應措施**

嘗試選擇配置新的 VM 大小。 如果不可行，請稍後再試。

## 附錄

### 錯誤字串查詢

**New_VMSizeNotSupported ***

由於部署要求條件約束，無法佈建此部署所需的 VM 大小 (或 VM 大小的總和)。 可能的話，請嘗試放寬約束條件 (例如虛擬網路繫結)、部署至不具有其他部署的託管服務及不同的同質群組 (或不具有同質群組的託管服務)，或嘗試部署至不同的區域。

**New_General ***

配置失敗；無法滿足要求中的條件約束。 要求的新服務部署繫結至同質群組，或以虛擬網路為目標，或此託管服務下已經有部署。 任何這些情況會將新的部署侷限於特定的 Azure 資源。 請稍後重試，或嘗試減少 VM 大小或角色執行個體的數量。 或者，可能的話，移除先前提到的條件約束，或試著部署到不同的區域。

**Upgrade_VMSizeNotSupported ***

無法升級部署。 在支援現有部署的資源中，可能沒有所要求的 VM 大小 XXX。 請稍後再試、嘗試使用不同的 VM 大小或較少的角色執行個體，或在空的託管服務下以建立新的同質群組或沒有同質群組繫結來建立部署。

**GeneralError***

伺服器發生內部錯誤。 請重試要求。 」 或者 「 無法產生服務的配置。





