<properties 
   pageTitle="Azure SQL Database 索引建議程式" 
   description="Azure SQL Database 索引建議程式會建議新的索引給現有 SQL Database 來改善目前的查詢效能。" 
   services="sql-database" 
   documentationCenter="" 
   authors="stevestein" 
   manager="jeffreyg" 
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management" 
   ms.date="12/01/2015"
   ms.author="sstein"/>

# SQL Database 索引建議程式

Azure SQL Database 索引顧問會建議新的索引給現有 SQL Database 來改善目前的查詢效能。

此 SQL Database 服務會分析 SQL Database 的資源使用歷程記錄來評估索引效能，並建議最適合執行資料庫一般工作負載的索引。

索引顧問會建議應該建立哪些索引，讓索引管理更輕鬆。 V12 伺服器中，索引顧問也可以建立及驗證索引中的幾個按一下 [Azure 入口網站](https://portal.azure.com/)。 建立索引之後，此 SQL Database 服務會分析資料庫工作負載的效能，並提供新索引帶來何種影響的詳細資料。 如果分析判斷所建議的索引不利於效能，則會自動還原索引。

索引顧問可節省您調整資料庫效能的時間。


> [AZURE.NOTE] 索引顧問目前為預覽狀態，僅供以 [Azure 入口網站](https://portal.azure.com/)。


## 預覽版本注意事項

索引顧問目前為預覽狀態，有下列限制：

- 只能對 V12 伺服器自動建立和驗證索引建議 (針對 V12 伺服器提供建議和索引建立指令碼)。
- 建議和管理僅適用於非叢集索引。

## 先決條件

若要檢視及建立索引建議，您必須正確 [角色型存取控制](role-based-access-control-configure.md) 在 Azure 中的權限。 

- **讀取器**, ，**SQL DB 參與者** 權限，才能檢視建議。
- **擁有者**, ，**SQL DB 參與者** 權限，才能執行任何動作; 建立或卸除索引並取消建立索引。


## 使用索引顧問

索引顧問很容易使用。 若要簡化資料庫的索引管理，請遵循下列指導方針：

- 首先檢閱索引建議清單，決定建立或忽略哪些索引。 建議清單依估計的效能影響來排序和標記 (詳述如下)。 
- 建立或忽略建議的索引。 按一下 [自動建立索引 **Create Index** 入口網站中，或手動執行索引建立指令碼來建立索引。
- 對於手動建立的索引，您應該監控建立程序，並測量的效能影響。 對於自動建立的索引，Azure SQL Database 服務會自動執行監視與效能影響分析。 



## 檢閱建議的索引

索引顧問提供索引建議清單中的 [資料庫] 刀鋒視窗上 [Azure 入口網站](https://portal.azure.com/)。 針對選取的資料庫中的每個資料表，將會顯示精選的建議，表示在其中建立新索引可能提高效能。

### 若要檢閱目前可用的索引建議：

1. 登入 [Azure 入口網站](https://portal.azure.com/)。
2. 按一下 [ **瀏覽** 左功能表中。
3. 按一下 [ **SQL 資料庫** 中 **瀏覽** 刀鋒視窗。
4. 在 **SQL 資料庫** 刀鋒視窗中，按一下您想要檢閱建議的索引的資料庫。
5. 按一下 [ **索引顧問** 開啟並檢視可用 **索引建議** 選取的資料庫。

> [AZURE.NOTE] 若要取得索引建議資料庫必須有一週的使用方式，和該週內需要有一些活動。 也需要有一些一致的活動。 相較於隨機蹦出的零星活動，一致的查詢模式更有利於索引建議程式最佳化。

![建議的索引][] 3

依照可能帶來的效能影響排序，建議分成下列 4 個類別：

| 影響 | 說明 |
| :--- | :--- |
| 高 | 高影響建議提供最明顯的效能影響。 |
| 顯著 | 顯著影響建議會明顯改善效能。 |
| 中度 | 中度影響建議會改善效能，但不顯著。 |
| 低 | 低影響建議比沒有索引時提供更好的效能，但改善可能不顯著。 
請使用 [影響] 標記決定最適合建立新索引的候選項目。

### 管理建議的索引清單

如果您建議的索引清單包含您覺得很有助益的索引，索引顧問可讓您捨棄索引建議 (您可以將捨棄的索引加回到 **建議的索引** 清單稍後如有需要)。

#### 捨棄索引建議

1. 在清單中選取索引 **建議的索引**。
1. 按一下 [ **捨棄索引** 上 **編製索引的詳細資料** 刀鋒視窗。

#### 檢視已捨棄的索引，並加回到主要清單

1. 在 **索引建議** 刀鋒視窗中按一下 **檢視捨棄索引建議**。
1. 從清單中選取捨棄的索引以檢視其詳細資料。
1. (選擇性) 按一下 **復原捨棄** ，將索引加回到主要清單 **索引建議**。



## 建立新的索引

索引顧問可讓您完整控制如何建立索引。 每個建議都提供 T-SQL 索引建立指令碼，在對資料庫採取任何動作之前，您可以檢閱將會如何建立索引的確切詳細資料。

索引建議適用於所有的 Azure SQL Database 伺服器，但只有 V12 伺服器提供自動化索引建立。 非 V12 伺服器仍然可以受益於索引顧問，但是您必須以手動方式建立索引，如下所述。

自動和手動建立索引選取建議的索引，從 **索引建議** 分頁，然後執行下列動作:

### 自動建立索引 (僅限 V12 伺服器)

如果資料庫是 V12 伺服器上，則您可以輕鬆地建立建議的索引選取想要在入口網站上的索引，然後按一下 **Create Index**。 

索引建立期間，資料庫仍然保持線上，使用索引顧問建立索引不會使資料庫離線。

此外，建立索引， **Create Index** 不需要進一步監控效能。 如果索引不利於效能，則會自動還原索引。 使用 [建立索引] 之後，入口網站中會顯示新索引的影響度量。 


### 手動建立索引 (所有伺服器)

在入口網站中選取任何建議的索引，然後按一下 **檢視指令碼**。 對資料庫執行這個指令碼來建立建議的索引。 對於手動建立的索引，並不會監視和驗證實際的效能影響，因此建議您在建立這些索引之後監視索引，以確認它們能夠提高效能，必要時調整或刪除它們。 如需有關建立索引的詳細資訊，請參閱 [CREATE INDEX (TRANSACT-SQL)](https://msdn.microsoft.com/library/ms188783.aspx)。


### 取消建立索引

中的索引 **暫止** 可以取消狀態。 正在建立的索引 (**執行** 狀態) 無法取消。

1. 選取任何 **暫止** 索引 **索引作業** 區域開啟 **編製索引的詳細資料** 刀鋒視窗。
1. 按一下 [ **取消** 中止索引建立程序。

## 建立索引之後監視索引作業

建立索引不會立即進行。 入口網站會提供有關索引作業狀態的詳細資料。 管理索引時，索引有下列可能的狀態：

| 狀態 | 說明 |
| :--- | :--- |
| Pending | 已收到建立索引命令，且排定索引準備建立。 |
| Executing | 建立索引命令正在執行，目前正在建立索引。 |
| 成功 | 已成功建立索引。 |
| Failed | 未建立索引。 這可能是暫時性問題，也可能是資料表的結構描述變更，造成指令碼不再有效。 |
| 還原 | 索引建立程序已取消或已確認無助於效能，正在自動還原。 |



![建議的索引][] 4



## 移除索引
您可以移除索引顧問已建立的索引。


1. 在清單中選取已成功建立的索引 **索引作業**。
1. 按一下 [ **移除索引** 上 **編製索引的詳細資料** 刀鋒視窗中或按一下 **檢視指令碼** DROP INDEX 指令碼。



## 摘要

索引建議提供自動化的經驗，可管理每一個 SQL 資料庫的索引建立與分析，並且建議最佳的索引。 按一下 [ **索引顧問** 磚以查看索引建議資料庫刀鋒視窗。



## 後續步驟

監視索引建議，並繼續套用以改善效能。 資料庫工作負載會動態地持續變更。 索引建議程式會繼續監視並建議可能改善資料庫效能的索引。 


<!--Image references-->
[1]: ./media/sql-database-index-advisor/index-recommendations.png
[2]: ./media/sql-database-index-advisor/index-details.png
[3]: ./media/sql-database-index-advisor/recommended-indexes.png
[4]: ./media/sql-database-index-advisor/index-operations.png




