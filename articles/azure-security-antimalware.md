<properties
   pageTitle="適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware | Microsoft Azure"
   description="本文提供適用於 Azure 的 Microsoft Antimalware 架構概觀，其中包括支援的案例和針對 Azure 雲端服務和虛擬機器啟用、設定及部署保護的設定。 我們將探討可經由 Microsoft Azure 服務管理 API、PowerShell 指令碼、Azure 管理入口網站及 Visual Studio 來存取的基本組態、管理和監視功能。"
   services="virtual-machines, cloud-services, storage"
   documentationCenter="na"
   authors="YuriDio"
   manager="swadhwa"
   editor=""/>

<tags
   ms.service="azure-security"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="12/10/2015"
   ms.author="yuridio"/>

#適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware

現今雲端環境的威脅型態非常多變，因此企業 IT 雲端訂閱者為了遵循法規與達到安全性需求，在維護有效保護機制方面承受許多壓力。 適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware 是一項即時保護功能，能協助識別及移除病毒、間諜軟體及其他惡意軟體，且具有可設定的警示，因此當已知惡意或垃圾軟體嘗試在您的 Azure 系統上自行安裝或執行時會發出警示。

解決方案建置在 Microsoft Security Essentials \[MSE\ 為相同的反惡意程式碼平台]，Microsoft Forefront Endpoint Protection、 Microsoft System Center Endpoint Protection、 Windows Intune 和 Windows 8.0 和更新版本的 Windows Defender。 適用於 Azure 的 Microsoft Antimalware 是一個針對應用程式和租用戶環境所提供的單一代理程式解決方案，其設計可於無人為介入的情況下在背景中執行。 您可依據應用程式工作負載需求，選擇預設的基本安全性或進階的自訂組態 (包括反惡意程式碼監視) 來部署保護。

當您為應用程式部署並啟用適用於 Azure 的 Microsoft Antimalware 時，有下列幾項核心功能可供使用：

**即時保護** -監視在雲端服務，來偵測及阻擋惡意程式碼執行的虛擬機器上的活動。

**排程掃描** -目標掃描來偵測惡意程式碼，包括執行程式會定期執行。

**惡意程式碼補救** -自動偵測到惡意程式碼，例如刪除或隔離惡意檔案和清除惡意的登錄項目上採取動作。

**簽章更新** -自動安裝最新保護簽名碼 （病毒定義） 來確定保護是最新的預先決定的頻率。

**反惡意程式碼引擎更新** – 自動更新 Microsoft 反惡意程式碼引擎。

**反惡意程式碼的平台更新** – 自動更新 Microsoft 反惡意程式碼的平台。

**作用中保護** ︰ 偵測到的威脅和可疑的資源相關報告遙測中繼資料，Microsoft azure，以確保快速回應威脅面形成因素，以及啟用即時同步簽章傳送到 Microsoft Active Protection 系統 (MAPS)。

**範例報告** -提供和報告給 Microsoft 反惡意程式碼服務，以協助改善服務，並啟用疑難排解的範例。

**排除項目** ︰ 可讓應用程式和服務系統管理員設定特定的檔案，處理程序，並且要排除保護和效能及/或其他原因而掃描的磁碟機。

**反惡意程式碼的事件集合** -記錄反惡意程式碼服務健全狀況、 可疑的活動，以及在作業系統事件記錄檔中所採取的修復動作，並會加以收集到客戶的 Azure 儲存體。

##架構

適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware 解決方案包含 Microsoft Antimalware 用戶端和服務、Antimalware 服務管理延伸模組、Antimalware PowerShell cmdlet 和 Azure 診斷延伸模組。 Windows Server 2008 R2、Windows Server 2012 和 Windows Server 2012 R2 作業系統系列可支援 Microsoft Antimalware 解決方案。 Windows Server 2008 作業系統則不支援此解決方案。 目前仍不支援 Windows Server Technical Preview，但是我們打算日後提供其支援服務。

依預設，Microsoft Antimalware 用戶端和服務是以停用狀態安裝在雲端服務平台中，所有支援的 Azure 客體作業系統系列上。

Microsoft Antimalware 用戶端和服務依預設不會安裝在虛擬機器平台中，而且可透過安全性延伸模組下的 Azure 管理入口網站和 Visual Studio 虛擬機器組態來使用的選擇性功能。

###Microsoft Antimalware 工作流程

Azure 服務系統管理員可針對您的虛擬機器和雲端服務，使用預設或自訂組態來啟用 Azure 的 Antimalware，可用選項如下：

-   虛擬機器 – 在 Azure 管理入口網站中，位於安全性延伸模組之下

-   虛擬機器 – 在伺服器瀏覽器中使用 Visual Studio 虛擬機器組態

-   虛擬機器和雲端服務 – 使用反惡意程式碼的服務管理 API (SMAPI)

-   虛擬機器和雲端服務 – 使用 Antimalware PowerShell Cmdlet

Azure 管理入口網站或 PowerShell cmdlet 會將反惡意程式碼延伸模組封裝檔案推送至 Azure 系統中的預定固定位置。 Azure 客體代理程式 (或網狀架構代理程式) 會啟動反惡意程式碼延伸模組，將提供的反惡意程式碼組態設定套用為輸入。 這個步驟可讓您以預設或自訂組態設定來啟動反惡意程式碼服務。 若未提供任何自訂組態，則將以預設組態設定來啟用反惡意程式碼服務。 請參閱 *反惡意程式碼設定* 一節中 [Microsoft 反惡意程式碼的 Azure 雲端服務和虛擬機器 – 程式碼範例](http://aka.ms/amazsamples "Microsoft 反惡意程式碼的 Azure 雲端服務和 Vm 的程式碼範例") 如需詳細資訊。

一旦執行時，Microsoft Antimalware 用戶端會從網際網路下載最新的保護引擎和簽章定義並將其載入 Azure 系統上。 Microsoft Antimalware 服務會將服務相關事件寫入至 Microsoft Antimalware 事件來源下的系統 OS 事件記錄檔中。 事件包括反惡意程式碼用戶端健康狀態、保護和補救狀態、新的和舊的組態設定、引擎更新和簽章定義及其他資訊。

您可以啟用雲端服務或虛擬機器的反惡意程式碼監視，以便在反惡意程式碼事件記錄檔事件產生至您的 Azure 儲存體帳戶時一同寫入。 反惡意程式碼服務會使用 Azure 診斷延伸模組將 Azure 系統中的反惡意程式碼事件收集至客戶的 Azure 儲存體帳戶中的資料表。

部署工作流程的設定步驟和支援上述案例中所述的選項包括 [反惡意程式碼的部署案例](#_Antimalware_Deployment_Scenarios) 這份文件的區段。

![Azure 中的 Microsoft Antimalware](./media/azure-security-antimalware/sec-azantimal-fig1.PNG)

###預設和自訂的反惡意程式碼組態

當您未提供自訂組態設定時，可套用預設的組態設定以啟動適用於 Azure 雲端服務或虛擬機器的反惡意程式碼程式。 預設組態設定已預先最佳化可在 Azure 環境中執行。 或者，您可以依 Azure 應用程式或服務部署的需要來自訂這些預設組態設定，並將其套用至其他部署案例。

下表摘要說明反惡意程式碼服務可用的組態設定。 預設的組態設定會在標示為「預設」的資料行下顯示標記。

![表 1](./media/azure-security-antimalware/sec-azantimal-tb18.PNG)

##反惡意程式碼部署案例

本節將討論啟用及設定反惡意程式碼的案例，包括 Azure 雲端服務和虛擬機器的監視。

###虛擬機器 - 啟用和設定反惡意程式碼

**使用 Azure Preview 入口網站進行部署**

若要啟用反惡意程式碼服務，請按一下 [ **新增** 的延伸模組分頁上，選取 **Microsoft 反惡意程式碼** 在新的資源刀鋒視窗中，按一下 [ **建立** Microsoft 反惡意程式碼] 分頁上。 按一下 [ **建立** 沒有輸入任何設定值，以啟用反惡意程式碼的預設設定，或輸入設定下方圖 2 所示的虛擬機器中的反惡意程式碼的組態設定。 請參閱 **工具提示** 隨附在加入延伸模組] 分頁上每個組態設定，請參閱 < 支援的設定值。

![Microsoft Antimalware 的虛擬機器組態設定](./media/azure-security-antimalware/sec-azantimal-fig2.PNG)

**使用 Azure 管理入口網站進行部署**

若要在佈建虛擬機器時，使用 Azure 管理入口網站來啟用和設定適用於 Azure 虛擬機器的 Microsoft Antimalware，請依照下列步驟執行：

1.在 Azure 管理入口網站上的記錄檔 <https://manage.windowsazure.com>

2.若要建立新的虛擬機器，請按一下 [ **新增**, ，**計算**, ，**虛擬** **機器**, ，**從組件庫** （不要使用 [快速建立），如下所示 ︰

![新虛擬機器](./media/azure-security-antimalware/sec-azantimal-fig3.PNG)


3.選取 **Microsoft Windows Server** 上的映像 **選擇映像** 頁面。

4.按一下向右箭號並輸入虛擬機器組態。

5.檢查 **Microsoft 反惡意程式碼** 核取方塊底下 **安全性延伸模組** 虛擬機器設定] 頁面上。

6.按一下 [提交] 按鈕，以使用預設的組態設定來啟用和設定適用於 Azure 虛擬機器的 Microsoft Antimalware。

![虛擬機器組態](./media/azure-security-antimalware/sec-azantimal-fig4.PNG)

**使用 Visual Studio 虛擬機器組態進行部署**

使用 Visual Studio 來啟用及設定 Microsoft Antimalware 服務：

1.在 Visual Studio 中連接至 Microsoft Azure。

2.選擇您的虛擬機器中 **虛擬機器** 節點 **伺服器總管**

![Visual Studio 中的虛擬機器組態](./media/azure-security-antimalware/sec-azantimal-fig5.PNG)

3.以滑鼠右鍵按一下 **設定** 若要檢視虛擬機器組態] 頁面

4.選取 **Microsoft 反惡意程式碼** 下方的下拉式清單中的延伸模組 **安裝擴充功能** 按一下 **新增** 使用預設反惡意程式碼的組態設定。

![已安裝的延伸模組](./media/azure-security-antimalware/sec-azantimal-fig6.PNG)

5.若要自訂預設反惡意程式碼設定，請安裝擴充功能清單中選取 （反白顯示） 反惡意程式碼延伸模組，然後按一下 **設定**。

6.中支援 JSON 格式的自訂組態以取代預設的反惡意程式碼設定 **公用組態** 文字方塊中按一下 [確定]。

7] 按一下 [ **更新** ] 按鈕，將組態更新推送至您的虛擬機器。

![虛擬機器組態延伸模組](./media/azure-security-antimalware/sec-azantimal-fig7.PNG)

**注意 ︰** 反惡意程式碼的 Visual Studio 虛擬機器組態僅支援 JSON 格式設定。 反惡意程式碼 JSON 設定設定範本包含在 [Microsoft 反惡意程式碼的 Azure 雲端服務和虛擬機器的程式碼範例](http://aka.ms/amazsamples "Microsoft 反惡意程式碼的 Azure 雲端服務和虛擬機器的程式碼範例"), ，顯示支援的反惡意程式碼組態設定。

**使用 PowerShell Cmdlet 進行部署**

Azure 應用程式或服務可使用 PowerShell Cmdlet 來啟用或設定適用於 Azure 虛擬機器的 Microsoft Antimalware。

若要使用反惡意程式碼 PowerShell Cmdlet 啟用及設定 Microsoft Antimalware：

1. 設定您的 PowerShell 環境-請參閱在文件 <https://github.com/Azure/azure-sdk-tools#get-started>

2. 啟用及設定虛擬機器的 Microsoft 反惡意程式碼所述使用 Set AzureVMMicrosoftAntimalwareExtension 反惡意程式碼指令程式 <http://msdn.microsoft.com/library/azure/dn771718.aspx>

**注意 ︰** 反惡意程式碼的 Azure 虛擬機器組態僅支援 JSON 格式設定。 反惡意程式碼 JSON 設定設定範本包含在 [Microsoft 反惡意程式碼的 Azure 雲端服務和虛擬機器的程式碼範例](http://aka.ms/amazsamples "Microsoft 反惡意程式碼的 Azure 雲端服務和虛擬機器的程式碼範例"), ，顯示支援的反惡意程式碼組態設定。

###使用 PowerShell Cmdlet 來啟用和設定 Antimalware

Azure 應用程式或服務可使用 PowerShell Cmdlet 來啟用或設定適用於 Azure 雲端服務的 Microsoft Antimalware。 請注意 Microsoft Antimalware 是以停用狀態安裝在雲端服務平台中，且需要 Azure 應用程式執行動作來啟用它。

若要使用 PowerShell Cmdlet 來啟用和設定 Microsoft Antimalware：

1.  設定您的 PowerShell 環境-請參閱在文件 <https://github.com/Azure/azure-sdk-tools#get-started>

2.  使用 Set AzureServiceAntimalwareExtension 反惡意程式碼指令程式來啟用和設定雲端服務的 Microsoft 反惡意程式碼所述 <http://msdn.microsoft.com/library/azure/dn771718.aspx>

反惡意程式碼的 XML 設定設定範本包含在 [Microsoft 反惡意程式碼的 Azure 雲端服務和虛擬機器的程式碼範例](http://aka.ms/amazsamples "Microsoft 反惡意程式碼的 Azure 雲端服務和虛擬機器的程式碼範例"), ，顯示支援的反惡意程式碼組態設定。

###雲端服務和虛擬機器 - 使用 PowerShell Cmdlet 進行設定

Azure 應用程式或服務可使用 PowerShell Cmdlet 來擷取適用於雲端服務和虛擬機器的 Microsoft Antimalware 組態。

若要使用 PowerShell Cmdlet 來擷取 Microsoft Antimalware 組態：

1.  設定您的 PowerShell 環境-請參閱在文件 <https://github.com/Azure/azure-sdk-tools#get-started>

2.  **虛擬機器的**︰ 使用 Get AzureVMMicrosoftAntimalwareExtension 反惡意程式碼指令程式以取得所述的反惡意程式碼設定 <http://msdn.microsoft.com/library/azure/dn771719.aspx>

3.  **雲端服務的**︰ 使用 Get AzureServiceAntimalwareConfig 反惡意程式碼指令程式以取得所述的反惡意程式碼設定 <http://msdn.microsoft.com/library/azure/dn771722.aspx>

###使用 PowerShell Cmdlet 來移除 Microsoft Antimalware 組態

Azure 應用程式或服務可從相關的 Azure Antimalware 以及與雲端服務或虛擬機器相關聯的診斷服務延伸模組中，移除反惡意程式碼組態和任何相關聯的反惡意程式碼監視。

若要使用 PowerShell Cmdlet 來移除 Microsoft Antimalware：

1.  設定您的 PowerShell 環境-請參閱在文件 <https://github.com/Azure/azure-sdk-tools#get-started>

2.  **虛擬機器的**︰ 所述，使用移除 AzureVMMicrosoftAntimalwareExtension 反惡意程式碼指令程式 <http://msdn.microsoft.com/library/azure/dn771720.aspx>

3.  **雲端服務 ︰** 所述，使用移除 AzureServiceAntimalwareExtension 反惡意程式碼指令程式 <http://msdn.microsoft.com/library/azure/dn771717.aspx>

若要 **啟用** 反惡意程式碼使用 Azure Preview 入口網站的虛擬機器的事件集合 ︰

1.  按一下 [虛擬機器] 刀鋒視窗中 [監視] 濾鏡的任何部分

2.  按一下 [度量] 刀鋒視窗中的 [診斷] 命令

3.  選取 **狀態** ON 並檢查 Windows 事件系統記錄檔的選項。 您可以選擇取消勾選清單中的所有其他選項，或是依每個應用程式服務的需要維持啟用狀態。

4.  「錯誤」、「警告」、「資訊性」等反惡意程式碼事件類別都會擷取在 Azure 儲存體帳戶中。

反惡意程式碼事件是從 Windows 事件系統記錄檔收集至您的 Azure 儲存體帳戶中。 您可以藉由選取適當的儲存體帳戶，為您的虛擬機器設定儲存體帳戶以收集反惡意程式碼事件。

![度量和診斷](./media/azure-security-antimalware/sec-azantimal-fig8.PNG)

###使用 PowerShell Cmdlet 來啟用和設定 Antimalware 監視

您可以透過 Antimalware PowerShell cmdlet 使用 Azure 診斷來啟用雲端服務或虛擬機器的 Microsoft Antimalware 事件集合。 您可以設定 Azure 診斷程式延伸模組，以從系統事件記錄檔來源 Microsoft Antimalware 擷取事件至 Azure 儲存體帳戶。 「錯誤」、「警告」、「資訊性」等反惡意程式碼事件類別都會擷取在 Azure 儲存體帳戶中。

若要使用 PowerShell cmdlet 在 Azure 儲存體帳戶中啟用反惡意程式碼事件集合：

1.  設定您的 PowerShell 環境-請參閱 <https://github.com/Azure/azure-sdk-tools#get-started>

2.  **虛擬機器的** -所述設定 AzureVMMicrosoftAntimalwareExtension 反惡意程式碼指令程式使用監視 ON 選項 <http://msdn.microsoft.com/library/azure/dn771716.aspx>

3.  **雲端服務的** -所述設定 AzureServiceAntimalwareExtension 反惡意程式碼指令程式使用監視 ON 選項 <http://msdn.microsoft.com/library/azure/dn771718.aspx>

您可以藉由查看 Azure 儲存體帳戶 (已設定來啟用反惡意程式碼監視) 中的 WADWindowsEventLogsTable 資料表來檢視 Antimalware 的原始事件。 這可有效地驗證反惡意程式碼事件集合是否正常運作，包括深入了解反惡意程式碼服務的健康狀態。 如需詳細資訊，包括如何從儲存體帳戶，擷取反惡意程式碼事件的範例程式碼，請參閱 [Microsoft 反惡意程式碼的 Azure 雲端服務和虛擬機器的程式碼範例](http://aka.ms/amazsamples "Microsoft 反惡意程式碼的 Azure 雲端服務和虛擬機器的程式碼範例")。


