<properties
    pageTitle="資料轉換輸出：儲存體的選項、分析 |Microsoft Azure"
    description="了解將串流分析資料轉換輸出的目標，設為資料儲存體選項。 還有，為分析結果使用 Power BI。"
    keywords="data transformation, analysis results, data storage options"
    services="stream-analytics,documentdb,sql-database,event-hubs,service-bus,storage"
    documentationCenter=""
    authors="jeffstokes72"
    manager="paulettm"
    editor="cgronlun"/>

<tags
    ms.service="stream-analytics"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="data-services"
    ms.date="12/01/2015"
    ms.author="jeffstok"/>

# 將串流分析資料轉換輸出的目標，設為分析工具及資料儲存體選項

當您在編寫串流分析工作時，請考慮資料轉換輸出的取用方式。 您要如何檢視串流分析工作的結果？ 您要使用哪些工具來顯示資料分析的結果？ 資料儲存體選項是必要的嗎？

為了要啟用各種應用程式模式，Azure 串流分析針對儲存輸出及檢視分析結果提供了數種不同的選項。 這讓您能輕鬆地檢視工作輸出，還讓您對於資料倉儲和其他用途之工作輸出的取用及儲存方式更有彈性。 任何在工作中設定的輸出，都必須在工作開始之前，以及在事件開始運作之前就已經存在。 例如，如果您把 Blob 儲存體當做輸出來使用，工作就不會自動建立儲存體帳戶。 使用者必須在 Azure 串流分析工作開始之前建立儲存體帳戶。


## SQL Database ##

[Azure SQL Database](http://azure.microsoft.com/services/sql-database/) 可用做為輸出的本質是關聯式的資料或應用程式是依賴主控關聯式資料庫中的內容。 串流分析工作會寫入至 Azure SQL Database 中的現有資料表。  請注意，資料表結構描述必須完全符合工作輸出的欄位及其類型。 下表列出屬性名稱及其描述以建立 SQL Database 輸出。

| 屬性名稱 | 說明 |
|---------------|-------------|
| 輸出別名 | 此為易記名稱，用於在查詢中將查詢輸出指向這個資料庫。 |
| 資料庫 | 您傳送輸出的資料庫名稱 |
| 伺服器名稱 | SQL Database 伺服器名稱 |
| 使用者名稱 | 具有寫入資料庫存取權限的使用者名稱 |
| 密碼 | 連接到資料庫的密碼 |
| 資料表 | 將在其中寫入輸出的資料表名稱。 資料表名稱會區分大小寫，且資料表的結構描述應該完全符合工作輸出所產生的欄位數目和其類型。 |

## Blob 儲存體 ##

若要將大量非結構化資料儲存於雲端，Blob 儲存體提供具有成本效益且可擴充的解決方案。  如需有關 Azure Blob 儲存體以及其使用方式的簡介，請參閱文件，網址 [如何使用 Blob](./articles/storage-dotnet-how-to-use-blobs.md)。

下表列出屬性名稱及其描述以建立 blob 輸出。

<table>
<tbody>
<tr>
<td>屬性名稱</td>
<td>描述</td>
</tr>
<tr>
<td>輸出別名</td>
<td>此為易記名稱，用於在查詢中將查詢輸出指向這個 blob 儲存體。</td>
</tr>
<tr>
<td>儲存體帳戶</td>
<td>您傳送輸出的儲存體帳戶名稱。</td>
</tr>
<tr>
<td>儲存體帳戶金鑰</td>
<td>與儲存體帳戶相關聯的密碼金鑰。</td>
</tr>
<tr>
<td>儲存體容器</td>
<td>容器提供邏輯分組給儲存在 Microsoft Azure Blob 服務中的 blob。 當您將 blob 上傳至 Blob 服務時，您必須指定該 blob 的容器。</td>
</tr>
<tr>
<td>路徑前置詞模式 [選用]</td>
<td>用來在指定容器中寫入 Blob 的檔案路徑。<BR>在該路徑內，您也可以選擇使用下列 2 個變數的一或多個執行個體來指定 blob 的寫入頻率：<BR>{date}、{time}<BR>範例 1：cluster1/logs/{date}/{time}<BR>範例 2：cluster1/logs/{date}</td>
</tr>
<tr>
<td>日期格式 [選用]</td>
<td>如果前置詞路徑中使用日期權杖，您可以選取組織檔案要用的日期格式。 範例：YYYY/MM/DD</td>
</tr>
<tr>
<td>時間格式 [選用]</td>
<td>如果前置詞路徑中使用時間權杖，請指定組織檔案要用的時間格式。 目前唯一支援的值為 HH。</td>
</tr>
<tr>
<td>事件序列化格式</td>
<td>輸出資料的序列化格式。  支援 JSON、CSV 和 Avro。</td>
</tr>
<tr>
<td>編碼</td>
<td>若為 CSV 或 JSON 格式，必須指定編碼。 UTF-8 是目前唯一支援的編碼格式。</td>
</tr>
<tr>
<td>分隔符號</td>
<td>僅適用於 CSV 序列化。 串流分析可支援多種序列化 CSV 資料常用的分隔符號。 支援的值是逗號、分號、空格、索引標籤和分隔號。</td>
</tr>
<tr>
<td>格式</td>
<td>僅適用於 JSON 序列化。 分隔的行會指定輸出的格式化方式為利用新行分隔每個 JSON 物件。 陣列會指定輸出將會格式化為 JSON 物件的陣列。</td>
</tr>
</tbody>
</table>

## 事件中心

[事件中樞](https://azure.microsoft.com/services/event-hubs/) 是高擴充性發行-訂閱可以擷取大量的事件。 它每秒可以收集數百萬個事件。  事件中樞做為輸出的其中一個使用時機，就是當串流分析工作的輸出將成為另一個串流工作的輸入時。

設定事件中樞串流做為輸出時，需要幾個參數。

| 屬性名稱 | 說明 |
|---------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 輸出別名 | 此為易記名稱，用於在查詢中將查詢輸出指向這個事件中樞。 |
| 服務匯流排 命名空間 | 服務匯流排命名空間是一個容器，包含一組訊息實體。 建立新的事件中樞時，也會建立服務匯流排命名空間 |
| 事件中心 | 事件中樞輸出的名稱 |
| 事件中樞原則名稱 | 共用的存取原則，可以在事件中樞的 [設定] 索引標籤上建立。 每一個共用存取原則會有名稱、權限 (由您設定) 和存取金鑰 |
| 事件中樞原則金鑰 | 用來驗證服務匯流排命名空間之存取權的共用存取金鑰 |
| 資料分割索引鍵資料行 [選用] | 這個資料行包含事件中樞輸出的資料分割索引鍵。 |
| 事件序列化格式 | 輸出資料的序列化格式。  支援 JSON、CSV 和 Avro。 |
| 編碼 | 對於 CSV 和 JSON 而言，UTF-8 是目前唯一支援的編碼格式 |
| 分隔符號 | 僅適用於 CSV 序列化。 串流分析可支援多種以 CSV 格式序列化資料常用的分隔符號。 支援的值是逗號、分號、空格、索引標籤和分隔號。 |
| 格式 | 僅適用於 JSON 類型。 分隔的行會指定輸出的格式化方式為利用新行分隔每個 JSON 物件。 陣列會指定輸出將會格式化為 JSON 物件的陣列。 |
## Power BI

[Power BI](https://powerbi.microsoft.com/) 可以做為輸出資料流分析工作用來提供豐富的視覺體驗的分析結果。 這項功能可以用於可運作的儀表板、產生報告，以及度量驅動的報告。

> [AZURE.NOTE] 在此階段中，建立及設定 Power BI 輸出不支援在 Azure 預覽入口網站。

### 授權 Power BI 帳戶

1.  在 Azure 管理入口網站中選取 Power BI 做為輸出時，您將會收到提示授權現有的 Power BI 使用者或建立新的 Power BI 帳戶。  

    ![授權 Power BI 使用者](./media/stream-analytics-define-outputs/01-stream-analytics-define-outputs.png)  

2.  如果您尚未擁有帳戶，請建立新帳戶，然後按一下 [立即授權]。  會顯示類似下列的畫面：  

    ![Azure 帳戶 Power BI](./media/stream-analytics-define-outputs/02-stream-analytics-define-outputs.png)  

3.  在此步驟中，請提供工作或學校帳戶以授權 Power BI 輸出。 如果您尚未註冊 Power BI，請選擇 [立即註冊]。 您用於 Power BI 的工作或學校帳戶可能與您目前用來登入的 Azure 訂用帳戶不同。

### 設定 Power BI 輸出屬性

驗證 Power BI 帳戶之後，您可以設定 Power BI 輸出的屬性。 下表是設定 Power BI 輸出的屬性名稱清單及其描述。

| 屬性名稱 | 說明 |
|---------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 輸出別名 | 此為易記名稱，用於在查詢中將查詢輸出指向這個 Power BI 輸出。 |
| 資料集名稱 | 提供 Power BI 輸出需要使用的資料集名稱 |
| 資料表名稱 | 提供 Power BI 輸出資料集的資料表名稱。 目前，串流分析工作的 Power BI 輸出中，一個資料集只能有一個資料表 |
| 群組名稱 | 若要啟用與其他 Power BI 使用者共用資料，請將資料寫入群組。  如果您不想寫入群組，您可以選取 Power BI 帳戶內的群組或選擇「我的工作區」。  更新現有的群組需要更新 Power BI 驗證。 |

設定 Power BI 輸出和儀表板的逐步解說，請參閱 [Azure 串流分析與 Power BI](stream-analytics-power-bi-dashboard.md) 文件。

> [AZURE.NOTE] 未明確建立資料集和資料表在 Power BI 儀表板。 當工作開始並將輸出提取至 Power BI 時，就會自動填入資料集和資料表。 請注意，如果工作查詢沒有產生任何結果，將不會建立資料集和資料表。 也請注意，如果 Power BI 已經具有與串流分析工作中提供的名稱相同的資料集和資料表，可能會覆寫現有的資料。

### 更新 Power BI 授權

有一個暫時性的限制，即每隔 90 天必須針對 Power BI 輸出的所有工作，以手動方式重新整理驗證 Token。  如果您在建立工作之後或上次驗證過後變更了密碼，您也必須重新驗證您的 Power BI 帳戶。  此問題發生時的徵兆就是沒有工作輸出，且作業記錄檔中出現「驗證使用者錯誤」：

  ![Power BI 重新整理權杖錯誤](./media/stream-analytics-define-outputs/03-stream-analytics-define-outputs.png)  

若要解決這個問題，請停止執行工作並移至 Power BI 輸出。  按一下 [更新授權] 連結，並從 [上次停止時間] 重新啟動您的工作以避免資料遺失。

  ![Power BI 更新授權](./media/stream-analytics-define-outputs/04-stream-analytics-define-outputs.png)  

## 資料表儲存體

[Azure 資料表儲存體](./articles/storage-introduction.md)  提供高可用性、 可大幅擴充的儲存體，因此應用程式可以自動調整以滿足使用者需求。 資料表儲存體是 Microsoft 的 NoSQL 索引鍵/屬性存放區，其中可以使用結構化資料，但結構描述的限制較少。 使用 Azure 資料表儲存資料時，資料可長期儲存而且調閱方便。

下表列出屬性名稱及其描述以建立資料表輸出。

| 屬性名稱 | 說明 |
|---------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 輸出別名 | 此為易記名稱，用於在查詢中將查詢輸出指向這個資料表儲存體。 |
| 儲存體帳戶 | 您傳送輸出的儲存體帳戶名稱。 |
| 儲存體帳戶金鑰 | 與儲存體帳戶相關聯的存取金鑰。 |
| 資料表名稱 | 資料表的名稱。 如果資料表不存在，將會建立資料表。 |
| 資料分割索引鍵 | 包含資料分割索引鍵的輸出資料行名稱。 在構成實體主索引鍵第一個部分的指定資料表內，資料分割索引鍵是資料分割的唯一識別碼。 大小最高為 1 KB 的字串值。 |
| 列索引鍵 | 包含資料列索引鍵的輸出資料行名稱。 資料列索引鍵是指定資料分割內實體的唯一識別碼。 它可構成實體主索引鍵的第二個部分。 資料列索引鍵是大小可能高達 1 KB 的字串值。 |
| 批次大小 | 批次作業的記錄數目。 預設值通常足以應付大部分的工作，請參閱 [資料表批次作業規格](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.table.tablebatchoperation.aspx) 如需有關修改此設定。 |

## 服務匯流排佇列

[服務匯流排佇列](https://msdn.microsoft.com/library/azure/hh367516.aspx) 先進先出 (FIFO) 訊息傳遞至一或多個競爭取用者。 通常會預期由接收者依訊息加入佇列的時間順序來接收和處理訊息，而且每則訊息只能由一個訊息取用者接收和處理。

下表列出屬性名稱及其描述以建立佇列輸出。

| 屬性名稱 | 說明 |
|----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 輸出別名 | 此為易記名稱，用於在查詢中將查詢輸出指向這個服務匯流排佇列。 |
| 服務匯流排 命名空間 | 服務匯流排命名空間是一個容器，包含一組訊息實體。 |
| 佇列名稱 | 服務匯流排佇列的名稱。 |
| 佇列原則名稱 | 當您建立佇列時，您也可以在 [佇列設定] 索引標籤上建立共用的存取原則。 每一個共用存取原則會有名稱、權限 (由您設定) 和存取金鑰。 |
| 佇列原則金鑰 | 用來驗證服務匯流排命名空間之存取權的共用存取金鑰 |
| 事件序列化格式 | 輸出資料的序列化格式。  支援 JSON、CSV 和 Avro。 |
| 編碼 | 對於 CSV 和 JSON 而言，UTF-8 是目前唯一支援的編碼格式 |
| 分隔符號 | 僅適用於 CSV 序列化。 串流分析可支援多種以 CSV 格式序列化資料常用的分隔符號。 支援的值是逗號、分號、空格、索引標籤和分隔號。 |
| 格式 | 僅適用於 JSON 類型。 分隔的行會指定輸出的格式化方式為利用新行分隔每個 JSON 物件。 陣列會指定輸出將會格式化為 JSON 物件的陣列。 |

## 服務匯流排主題

雖然服務匯流排佇列提供來自寄件者對接收者，一對一通訊方法 [服務匯流排主題](https://msdn.microsoft.com/library/azure/hh367516.aspx) 提供一對多的一種通訊。

下表列出屬性名稱及其描述以建立資料表輸出。

| 屬性名稱 | 說明 |
|----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 輸出別名 | 此為易記名稱，用於在查詢中將查詢輸出指向這個服務匯流排主題。 |
| 服務匯流排 命名空間 | 服務匯流排命名空間是一個容器，包含一組訊息實體。 建立新的事件中樞時，也會建立服務匯流排命名空間 |
| 主題名稱 | 主題為訊息實體，類似於事件中樞和佇列。 它們可以收集各種裝置和服務的事件資料流。 建立主題時也會給予其特定名稱。 除非已建立訂用帳戶，否則傳送至主題的訊息將無法使用，所以請確保該主題內有一或多個訂用帳戶 |
| 主題原則名稱 | 當您建立主題時，您也可以在 [主題設定] 索引標籤上建立共用的存取原則。 每一個共用存取原則會有名稱、權限 (由您設定) 和存取金鑰 |
| 主題原則金鑰 | 用來驗證服務匯流排命名空間之存取權的共用存取金鑰 |
| 事件序列化格式 | 輸出資料的序列化格式。  支援 JSON、CSV 和 Avro。 |
| 編碼 | 若為 CSV 或 JSON 格式，必須指定編碼。 UTF-8 是目前唯一支援的編碼格式 |
| 分隔符號 | 僅適用於 CSV 序列化。 串流分析可支援多種以 CSV 格式序列化資料常用的分隔符號。 支援的值是逗號、分號、空格、索引標籤和分隔號。 |

## DocumentDB

[Azure DocumentDB](http://azure.microsoft.com/services/documentdb/) 是完全受管理 NoSQL 文件資料庫服務，透過無結構描述的資料、 可預測且可靠的效能，並快速開發提供查詢和交易。

下表列出用於建立 DocumentDB 輸出的屬性名稱及其描述。

<table>
<tbody>
<tr>
<td>屬性名稱</td>
<td>描述</td>
</tr>
<tr>
<td>帳戶名稱</td>
<td>DocumentDB 帳戶的名稱。  這也會是帳戶的端點。</td>
</tr>
<tr>
<td>帳戶金鑰</td>
<td>DocumentDB 帳戶的共用存取金鑰。</td>
</tr>
<tr>
<td>資料庫</td>
<td>DocumentDB 資料庫名稱。</td>
</tr>
<tr>
<td>集合名稱模式</td>
<td>要使用之集合的集合名稱模式。 您可以使用選用的 {partition} 語彙基元來建構集合名稱的格式，其中的資料分割會從 0 開始。<BR>例如 以下是有效的輸入：<BR>MyCollection{partition}<BR>MyCollection<BR>請注意，集合必須在資料流分析工作啟動之前便存在，而且不會自動建立。</td>
</tr>
<tr>
<td>資料分割索引鍵</td>
<td>輸出事件中的欄位名稱會用來為跨集合的資料分割輸出指定索引鍵。</td>
</tr>
<tr>
<td>文件識別碼</td>
<td>輸出事件中的欄位名稱會用來指定主索引鍵，其為插入或更新作業的依據。</td>
</tr>
</tbody>
</table>


## 取得說明
如需進一步的協助，請嘗試我們 [Azure 串流分析論壇](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics)

## 後續步驟
以上就是串流分析 (物聯網資料串流分析專用的受管理服務) 的簡介。 若要深入了解此服務，請參閱：

- [開始使用 Azure 資料流分析](stream-analytics-get-started.md)
- [調整 Azure 資料流分析工作](stream-analytics-scale-jobs.md)
- [Azure Stream Analytics 查詢語言參考](https://msdn.microsoft.com/library/azure/dn834998.aspx)
- [Azure 串流分析管理 REST API 參考](https://msdn.microsoft.com/library/azure/dn835031.aspx)

<!--Link references-->
[stream.analytics.developer.guide]: ../stream-analytics-developer-guide.md
[stream.analytics.scale.jobs]: stream-analytics-scale-jobs.md
[stream.analytics.introduction]: stream-analytics-introduction.md
[stream.analytics.get.started]: stream-analytics-get-started.md
[stream.analytics.query.language.reference]: http://go.microsoft.com/fwlink/?LinkID=513299
[stream.analytics.rest.api.reference]: http://go.microsoft.com/fwlink/?LinkId=517301


